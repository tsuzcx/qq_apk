package com.tencent.ttpic.filter;

import android.graphics.Bitmap;
import android.graphics.PointF;
import android.opengl.GLES20;
import com.tencent.aekit.api.standard.AEModule;
import com.tencent.aekit.openrender.AEOpenRenderConfig.DRAW_MODE;
import com.tencent.aekit.openrender.AttributeParam;
import com.tencent.aekit.openrender.UniformParam.Float2fParam;
import com.tencent.aekit.openrender.UniformParam.FloatParam;
import com.tencent.aekit.openrender.UniformParam.TextureParam;
import com.tencent.aekit.openrender.internal.VideoFilterBase;
import com.tencent.aekit.openrender.util.GlUtil;
import com.tencent.filter.BaseFilter;
import com.tencent.ttpic.baseutils.bitmap.BitmapUtils;
import com.tencent.ttpic.baseutils.io.FileUtils;
import com.tencent.ttpic.baseutils.log.LogUtils;
import com.tencent.ttpic.openapi.PTDetectInfo;
import com.tencent.ttpic.openapi.model.FaceItem;
import com.tencent.ttpic.openapi.model.VideoMaterial;
import com.tencent.ttpic.openapi.util.VideoMaterialUtil;
import com.tencent.ttpic.openapi.util.VideoTemplateParser;
import com.tencent.ttpic.util.FaceOffUtil;
import java.io.File;
import java.util.List;

public class FaceFeatureFilterReshape
  extends VideoFilterBase
{
  private static final String CONTENT = "{\n  \"minAppVersion\": 400,\n  \"shaderType\": 5,\n  \"maxFaceCount\": 10,\n  \"faceOffType\": 0,\n  \"faceOffItemList\": [\n  {\n    \"faceExchangeImage\": \"beauty_normal.png\",\n    \"blendAlpha\":1.0,\n    \"featureType\": 0,\n    \"grayScale\": 0,\n\t\"blendMode\": 1,\n\t\"facePoints\": [\n156.88185140529998, 528.1364190166,\n  169.5493300902, 595.3714981903,\n  181.24238733779998, 649.9390986791,\n  191.9610231481, 695.7369062322,\n  214.372716206, 738.6114494734,\n  238.7332521385, 776.6138855281,\n  277.71010963049997, 811.6930572709,\n  311.814859936, 843.8489647018,\n  351.7661388653, 868.2095006343,\n  398.53836785569996, 876.97929357,\n  445.3105968461, 866.2606577596999,\n  491.10840439919997, 841.9001218272,\n  528.1364190166, 807.7953715217,\n  558.3434835729, 769.792935467,\n  585.6272838172999, 734.7137637242,\n  605.1157125633, 690.8647990457,\n  618.7576126855, 645.0669914926,\n  630.4506699331, 592.4482338784,\n  633.373934245, 524.2387332674,\n  199.75639464649998, 446.2850182834,\n  239.7076735758, 444.3361754088,\n  280.6333739424, 448.23386115799997,\n  321.559074309, 456.0292326564,\n  362.48477467559997, 458.9524969683,\n  327.4056029328, 433.6175395985,\n  283.55663825429997, 425.8221681001,\n  239.7076735758, 425.8221681001,\n  595.3714981903, 445.3105968461,\n  555.4202192609999, 444.3361754088,\n  515.4689403317, 452.1315469072,\n  484.28745433809996, 457.0036540937,\n  438.489646785, 460.9013398429,\n  464.7990255921, 435.56638247309996,\n  508.64799027059996, 422.89890378819996,\n  559.3179050102, 422.89890378819996,\n  241.6565164504, 506.699147396,\n  260.1705237591, 518.3922046435999,\n  285.5054811289, 522.2898903928,\n  309.8660170614, 520.3410475182,\n  336.1753958685, 511.5712545825,\n  317.6613885598, 493.0572472738,\n  287.4543240035, 483.3130329008,\n  263.093788071, 489.1595615246,\n  291.3520097527, 504.7503045214,\n  291.3520097527, 502.80146164679996,\n  558.3434835729, 501.8270402095,\n  537.8806333896, 516.443361769,\n  511.5712545825, 523.2643118300999,\n  487.21071865, 521.3154689555,\n  460.9013398429, 512.5456760198,\n  481.3641900262, 492.0828258365,\n  508.64799027059996, 484.28745433809996,\n  534.9573690777, 488.1851400873,\n  508.64799027059996, 502.80146164679996,\n  508.64799027059996, 500.8526187722,\n  370.280146174, 512.5456760198,\n  366.3824604248, 600.2436053768,\n  340.0730816177, 649.9390986791,\n  370.280146174, 668.4531059878,\n  400.4872107303, 672.350791737,\n  428.745432412, 666.5042631132,\n  458.9524969683, 647.0158343672,\n  432.6431181612, 601.2180268141,\n  430.6942752866, 513.5200974571,\n  400.4872107303, 636.2971985569,\n  312.7892813733, 719.1230207274,\n  489.1595615246, 717.1741778528,\n  335.2009744312, 743.4835566598999,\n  364.4336175502, 759.0742996567,\n  399.51278929299997, 766.8696711550999,\n  434.5919610358, 758.0998782194,\n  464.7990255921, 741.5347137853,\n  442.38733253419997, 736.6626065987999,\n  401.4616321676, 741.5347137853,\n  352.7405603026, 736.6626065987999,\n  346.8940316788, 713.2764921035999,\n  379.0499391097, 710.3532277917,\n  401.4616321676, 714.2509135409,\n  421.9244823509, 713.2764921035999,\n  454.08038978179997, 713.2764921035999,\n  442.38733253419997, 729.8416565377,\n  400.4872107303, 731.7904994122999,\n  354.6894031772, 727.8928136631,\n  400.4872107303, 512.5456760198,\n  404.3848964795, 460.9013398429,\n  400.4872107303, 692.8136419203,\n  205.60292327029998, 205.60292327029998,\n  398.53836785569996, 275.7612667559,\n  598.2947625022, 197.8075517719,\n  400.4872107303, 356.63824605179997\n    ]\n  }\n  \n  ]\n}\n\n";
  private static final String FOLDER = "assets://realtimeBeauty";
  public static final String FRAGMENT_SHADER = "mee2959x1667592816x1869181801x1768431726x544237671x1634692198x1980382068x1769566817x1981835118x540173157x1986945379x1866691425x1768190575x1702125934x1635125819x1852406130x1702240359x1948267107x1970567269x1866687858x1768190575x1702125934x1963592251x1868982638x1931505010x1819307361x1144156773x1886284064x1833530485x1415931745x1970567269x171664754x1718185589x544043631x1886216563x846357868x1852383300x1232369008x1701273965x1954047316x845509237x1853164091x1919903337x1634934893x1701605485x541340274x1970302569x1634552180x1700029799x1920300152x171651941x1718185589x544043631x1886216563x846357868x1852383300x1232369008x1701273965x1954047316x879063669x1963592251x1868982638x1713401202x1952542572x1886150944x171663720x1667593738x1818370100x1130655333x1919904879x1667593768x1702109236x1819231096x539783791x878929270x1851876128x1131635062x1919904879x1852383276x1818370164x1298427493x694510703x537557770x1981816864x540238693x1701728118x1981824288x674456421x741355057x808333600x774971436x171649328x538976288x862152054x1700427296x1025535858x1667593760x774907955x807414832x539766830x691023408x538970683x791617568x1702258034x1881175154x1830839666x1769237621x175729776x538976288x1948804713x1866692709x779251564x540942433x691023408x538970747x538976288x2019914784x1869377347x1735536242x540876898x1131963764x1919904879x1650946606x1948266272x1866692709x779251564x537541473x2099257376x538976266x1667593760x1701978163x1953265011x1701998406x1948269856x1866692709x779251564x996304754x538976266x543582496x1701601832x1867342958x1008756068x691085373x791617659x1634100580x745827445x1852404512x1965057379x543450483x1953722221x1970282540x1852776564x1886352416x538970634x545071136x1702063205x543582496x1701601832x1867342958x1025533284x691150909x538999584x1970089775x1885959276x537557356x538976288x1914708000x1819636581x1919895156x540876901x1986945379x1866691425x779251564x543319922x1702109226x1819231096x1915646575x171663975x538976288x1818566781x1763730803x1646796902x1684956524x1701080909x540884256x544942390x790634528x1718580015x1734962292x537556072x538976288x1914708000x1819636581x1919895156x540876901x540028466x1633886250x1935767150x1869377347x1735536242x539631714x1131963764x1919904879x1650946606x1663052576x1635151457x1819231091x1915646575x706765415x1851876128x1131635062x1919904879x1650946606x673196576x1701728118x840969504x706752558x2019914784x1869377347x1735536242x171649378x538976288x538976288x673212009x1131963764x1919904879x1042313774x774905917x2065705269x538976266x538976288x538976288x1936028192x1182035061x778400367x540876914x540028466x1633886250x1935767150x1869377347x544353906x824713258x757084206x2019914784x1869377347x695348850x673196832x540028466x1702109226x1819231096x1915646575x824192288x539570222x1903370282x1663595634x1635151457x1819231091x1915646575x537541417x538976288x2099257376x538976266x538976288x543582496x2019914792x1869377347x543633010x807419198x539571502x538970747x538976288x538976288x1701978144x1953265011x1701998406x1025533742x808333856x1663052320x1635151457x1819231091x1731097199x673196576x540028465x1702109229x1819231096x1731097199x539697193x808333864x1948264992x1866692709x779251564x539828327x691023409x1931487776x678720113x1986945379x1866691425x779251564x171649383x538976288x538976288x538970749x538976288x1718165536x1702111264x1819231096x1647211119x540884512x691351088x537557792x538976288x538976288x1914708000x1819636581x1919895156x543305317x775036989x539631664x1986945379x1866691425x779251564x539631714x808333608x1948265760x1866692709x779251564x723528034x775039008x539631664x1131963764x1919904879x757097006x808333600x539631657x1953657203x1851876136x1131635062x1919904879x992567854x538976266x538976288x537558304x2099257376x538976266x1882140448x1830839666x1769237621x544828528x544370534x1816292455x1180986981x174288501x538976288x878929270x1936028192x1131703413x1919904879x1981824288x674521957x1970496882x1866888300x706766194x2019914784x1869377347x744566386x2019914784x1869377347x694234738x537528891x1914708000x1819636581x1819231092x1025536623x1667593760x1701980212x1953265011x1869377347x1735536242x539631714x540028465x1633886251x1935767150x1869377347x1735536242x539631714x808333608x1914711328x1819636581x1819231092x1630433903x824192041x992555054x538970634x1701978144x1852994932x1936028192x1131703413x1919904879x175966779x1768912394x1634541668x1982361193x694446447x537557792x1981816864x540304229x1986945379x1866691425x544370540x1702109245x1920300152x675557989x1970302569x1634552180x1700029799x1920300152x1663052901x1635151457x1869562739x1852400754x694514785x538970683x1702240288x1931490403x1282696815x1952999273x1131963732x1919904879x1948269856x1970567269x1144153458x1886284072x1833530485x1415931745x1970567269x741500274x2019914784x1701999988x1919905603x1634625892x992568692x538976266x1667593760x1970085940x1885959276x1700034924x1819231096x1025536623x2019914784x1701999988x1764246578x1953853550x1734438217x2019906661x1701999988x1948265523x1970567269x1866687858x1768190575x1702125934x537541417x1981816864x540304229x1836216174x1700031585x1819231096x1025536623x2019914784x1701999988x1764246578x1953853550x1734438217x2019906661x1701999988x1948265524x1970567269x1866687858x1768190575x1702125934x168442665x538976288x673212009x1952870259x1751607628x2019906676x1869377347x543239794x774905918x2065705264x538976266x538976288x1718580000x1734954100x1700033640x1819231096x1025536623x1718580000x1734954100x1700033640x1819231096x790655599x1667593760x1869817908x1766618214x1416915047x1866692709x779251564x1931488353x1282696815x1952999273x1131963732x1919904879x539779374x1952870259x1751607628x2019906676x1869377347x744566386x808333600x537541417x2099257376x538976266x1718580000x1734954100x1700033640x1819231096x1630433903x1931492640x1282696815x1952999273x1131963732x1919904879x706765102x1886150944x171663720x538976266x1718580000x1734954100x1700033640x1819231096x1915646575x1025532519x1718580000x1734954100x1700033640x1819231096x1915646575x706765415x1718580000x1734954100x1700033640x1819231096x1630433903x537528891x1763713056x1831346278x1769237621x1417243760x1866692709x779251564x540942433x691023408x537557792x538976288x1830821920x1769237621x1417243760x1866692709x544370540x1970085949x1885959276x1700034924x1819231096x790655599x1667593760x1970087988x1885959276x1700034924x1819231096x1630433903x1970085932x1885959276x1700034924x1819231096x1630433903x1970085932x1885959276x1700034924x1819231096x1630433903x774971436x171649328x538976288x538970749x1970085920x1885959276x1700034924x1819231096x1630433903x1830829344x1769237621x1417243760x1866692709x779251564x539631713x1752198241x168442721x538976288x1953265005x2037149801x1131963732x1919904879x1650946606x1830829344x1769237621x1417243760x1866692709x779251564x543319922x1970085930x1885959276x1700034924x1819231096x1630433903x537528891x1763713056x1848123494x1634562671x2019906668x1869377347x543239794x774905918x2065705264x538976266x538976288x1919905312x1416388973x1866692709x544370540x1869488189x1818324338x1131963732x1919904879x1981820704x674521957x1836216174x1700031585x1819231096x1630433903x1869488172x1818324338x1131963732x1919904879x539779374x1836216174x1700031585x1819231096x1630433903x774971436x171649328x538976288x538970749x1869488160x1818324338x1131963732x1919904879x1025532206x1919905312x1416388973x1866692709x779251564x539631713x1752198241x168442721x538976288x1836216174x1700031585x1819231096x1915646575x1025532519x1919905312x1416388973x1866692709x779251564x543319922x1869488170x1818324338x1131963732x1919904879x171663662x538970634x1702240288x1914713187x1819636581x1819231092x1025536623x1701601824x1866687598x678588268x1952870259x1751607628x2019906676x1869377347x1663052914x1635151457x1819231091x539783791x171649334x538976288x1970496882x1866691692x544370540x1818370109x1130655333x1919904879x1819634984x1819306356x2019906681x1869377347x1914711154x1819636581x1819231092x539783791x171649330x538976288x1180658791x1130848626x1919904879x1646279968x1684956524x1869377347x1869490290x1818324338x1131963732x1919904879x1701978156x1953265011x1869377347x824192114x168442665x687392x";
  private static final String TAG = FaceFeatureFilterReshape.class.getSimpleName();
  public static final String VERTEX_SHADER = "mee1841x1920234593x1953849961x1702240357x1881158755x1953067887x997093225x1953784074x1969383794x1981834612x540173157x1970302569x2019906676x1701999988x1919905603x1634625892x171664756x2037539190x543649385x845374838x1851876128x1131635062x1685221231x1952542313x1980382053x1769566817x1981835118x540173157x1954047348x1130721909x1685221231x1952542313x168442725x1718185589x544043631x845374838x1851876128x1400070518x996506217x1768846602x1836216166x1869375008x1881175137x1953067887x1382969193x1952543855x168442725x880042349x1936683040x1383358797x1952543855x540876901x880042349x808333608x774905900x807414832x539766830x741355056x538976266x538976288x538976288x538976288x538976288x538976288x774905888x824192048x539766830x741355056x808333344x538970668x538976288x538976288x538976288x538976288x538976288x807411744x539766830x741355056x808333600x774905900x537537584x538976288x538976288x538976288x538976288x538976288x538976288x741355056x808333344x774905900x824192048x992555054x1634535946x1830827124x1379169377x1952543855x1500409705x1831361112x540308577x1713384557x1952542572x1632794656x1851877732x1713384563x1952542572x1632794912x1851877732x1713384563x1952542572x1632795168x1851877732x2065705331x538976266x170536736x538976288x538999840x2053339491x1931488032x1937339256x538976378x2020833891x757102963x1937335072x538976378x2037610595x540024864x1293945468x2082487584x2019762208x538999411x538976288x538976288x2019762208x538999395x538976288x538976288x2020814112x538976288x175906864x538976288x538999840x2020833635x757103219x1937400608x538976377x2053339491x723548275x1937339168x538976378x2036562019x540024864x538970748x2082480160x540024864x538976288x538976288x538976288x540024864x538976288x538976288x538976288x540024864x538976288x175906865x538976266x1752637472x543519333x1025524067x1936679712x740901160x541160224x1769152573x692136046x1919903264x1025524000x2032957472x537557548x538976288x168439594x538976288x1634692198x2019762292x1663057184x2015916911x1768186194x695430753x538970683x1818632224x544498031x1025538163x1852404512x1632794664x1851877732x171649395x538976288x1634692198x2036539508x1663057184x2032694127x1768186194x695430753x538970683x1818632224x544498031x1025538419x1852404512x1632794920x1851877732x171649395x538976288x1634692198x2053316724x1663057184x2049471343x1768186194x695430753x538970683x1818632224x544498031x1025538675x1852404512x1632795176x1851877732x171649395x538976266x811298080x1563450205x673201440x706771299x695886624x673196832x706771059x544830240x2054365226x537541417x1830821920x1532833883x1025531185x544760608x2054365226x538970683x1533878304x844848432x540876893x544826152x2020810794x1931487776x757082490x2053318688x1931487776x171649401x538976288x1563450221x542978907x774905917x168442672x538976288x1563515757x542978139x1663574077x539631738x706771059x695825184x673197344x706771299x695890720x538970683x1533878304x828071217x540876893x706771043x997876512x538976266x828075296x1563581277x673201440x706771299x544891680x2020810794x539697193x544830248x2054365226x537541417x1830821920x1532834139x1025531187x808333344x537528891x1830821920x1532834395x1025531184x544760608x2037588010x538970683x1533878304x828071218x540876893x997749549x538976266x844852512x1563581277x1663057184x539631736x171669859x538976288x1563581293x542978907x774905917x168442672x538976288x1563646829x542978139x774905917x537541424x1830821920x1532834651x1025531185x808333344x538970683x1533878304x844848435x540876893x993013296x538976266x861629728x1563646813x824196384x171651118x538976266x1952805408x544109173x2097822573x1870006794x1830839401x678324577x537557801x1981816864x540304229x1835102822x1936674917x1881160992x1953067887x997093225x538970634x1919295520x1348824417x2016310127x1713388832x1701667186x779317072x539631736x1986945379x1767076705x2016306554x807414304x171652398x538976288x1835102822x1936674917x1025538350x1634887200x1867539821x544812659x1633886250x1935767150x1702521171x706771246x892219424x538970683x1869619232x1952533875x1635020626x1025533300x1952541984x1953452596x1869182049x1515739502x1936683048x1383358797x1952543855x807414885x539766830x741355056x1936683040x1869182057x1953452654x694514785x538970683x1919295520x1348824417x1025536879x1936683040x1383358797x1952543855x539631717x1835102822x1936674917x538970683x1919295520x1348824417x2016310127x1713388832x1701667186x779317072x539631736x540028466x1633886255x1935767150x1702521171x171669550x538976288x1835102822x1936674917x1025538350x1634887200x1867539821x544812659x775036970x539959344x1986945379x1767076705x2033083770x537528891x1730158624x1867538284x1769236851x1025535599x1634887200x1867539821x537541491x1663049760x1635151457x1869562739x1852400754x543519841x1702240317x1713910371x1701667186x779317072x539631736x540356144x774905899x1713384501x1701667186x779317072x539631737x540356144x774905899x171649333x538976288x1954047348x1130721909x1685221231x1952542313x540876901x1970302569x2019906676x1701999988x1919905603x1634625892x171664756x125x";
  private float alpha = 0.8F;
  private int faceImageHeight;
  private int faceImageWidth;
  private float[] faceVertices = new float[1380];
  private boolean isFaceImageReady;
  private FaceItem item = createFaceItem();
  private Bitmap multiplyBitmap;
  private Bitmap normalBitmap;
  private int sampleSize;
  private Bitmap softLightBitmap;
  private float[] texVertices = new float[1380];
  private int[] texture = new int[3];
  
  public FaceFeatureFilterReshape()
  {
    super(BaseFilter.nativeDecrypt("mee1841x1920234593x1953849961x1702240357x1881158755x1953067887x997093225x1953784074x1969383794x1981834612x540173157x1970302569x2019906676x1701999988x1919905603x1634625892x171664756x2037539190x543649385x845374838x1851876128x1131635062x1685221231x1952542313x1980382053x1769566817x1981835118x540173157x1954047348x1130721909x1685221231x1952542313x168442725x1718185589x544043631x845374838x1851876128x1400070518x996506217x1768846602x1836216166x1869375008x1881175137x1953067887x1382969193x1952543855x168442725x880042349x1936683040x1383358797x1952543855x540876901x880042349x808333608x774905900x807414832x539766830x741355056x538976266x538976288x538976288x538976288x538976288x538976288x774905888x824192048x539766830x741355056x808333344x538970668x538976288x538976288x538976288x538976288x538976288x807411744x539766830x741355056x808333600x774905900x537537584x538976288x538976288x538976288x538976288x538976288x538976288x741355056x808333344x774905900x824192048x992555054x1634535946x1830827124x1379169377x1952543855x1500409705x1831361112x540308577x1713384557x1952542572x1632794656x1851877732x1713384563x1952542572x1632794912x1851877732x1713384563x1952542572x1632795168x1851877732x2065705331x538976266x170536736x538976288x538999840x2053339491x1931488032x1937339256x538976378x2020833891x757102963x1937335072x538976378x2037610595x540024864x1293945468x2082487584x2019762208x538999411x538976288x538976288x2019762208x538999395x538976288x538976288x2020814112x538976288x175906864x538976288x538999840x2020833635x757103219x1937400608x538976377x2053339491x723548275x1937339168x538976378x2036562019x540024864x538970748x2082480160x540024864x538976288x538976288x538976288x540024864x538976288x538976288x538976288x540024864x538976288x175906865x538976266x1752637472x543519333x1025524067x1936679712x740901160x541160224x1769152573x692136046x1919903264x1025524000x2032957472x537557548x538976288x168439594x538976288x1634692198x2019762292x1663057184x2015916911x1768186194x695430753x538970683x1818632224x544498031x1025538163x1852404512x1632794664x1851877732x171649395x538976288x1634692198x2036539508x1663057184x2032694127x1768186194x695430753x538970683x1818632224x544498031x1025538419x1852404512x1632794920x1851877732x171649395x538976288x1634692198x2053316724x1663057184x2049471343x1768186194x695430753x538970683x1818632224x544498031x1025538675x1852404512x1632795176x1851877732x171649395x538976266x811298080x1563450205x673201440x706771299x695886624x673196832x706771059x544830240x2054365226x537541417x1830821920x1532833883x1025531185x544760608x2054365226x538970683x1533878304x844848432x540876893x544826152x2020810794x1931487776x757082490x2053318688x1931487776x171649401x538976288x1563450221x542978907x774905917x168442672x538976288x1563515757x542978139x1663574077x539631738x706771059x695825184x673197344x706771299x695890720x538970683x1533878304x828071217x540876893x706771043x997876512x538976266x828075296x1563581277x673201440x706771299x544891680x2020810794x539697193x544830248x2054365226x537541417x1830821920x1532834139x1025531187x808333344x537528891x1830821920x1532834395x1025531184x544760608x2037588010x538970683x1533878304x828071218x540876893x997749549x538976266x844852512x1563581277x1663057184x539631736x171669859x538976288x1563581293x542978907x774905917x168442672x538976288x1563646829x542978139x774905917x537541424x1830821920x1532834651x1025531185x808333344x538970683x1533878304x844848435x540876893x993013296x538976266x861629728x1563646813x824196384x171651118x538976266x1952805408x544109173x2097822573x1870006794x1830839401x678324577x537557801x1981816864x540304229x1835102822x1936674917x1881160992x1953067887x997093225x538970634x1919295520x1348824417x2016310127x1713388832x1701667186x779317072x539631736x1986945379x1767076705x2016306554x807414304x171652398x538976288x1835102822x1936674917x1025538350x1634887200x1867539821x544812659x1633886250x1935767150x1702521171x706771246x892219424x538970683x1869619232x1952533875x1635020626x1025533300x1952541984x1953452596x1869182049x1515739502x1936683048x1383358797x1952543855x807414885x539766830x741355056x1936683040x1869182057x1953452654x694514785x538970683x1919295520x1348824417x1025536879x1936683040x1383358797x1952543855x539631717x1835102822x1936674917x538970683x1919295520x1348824417x2016310127x1713388832x1701667186x779317072x539631736x540028466x1633886255x1935767150x1702521171x171669550x538976288x1835102822x1936674917x1025538350x1634887200x1867539821x544812659x775036970x539959344x1986945379x1767076705x2033083770x537528891x1730158624x1867538284x1769236851x1025535599x1634887200x1867539821x537541491x1663049760x1635151457x1869562739x1852400754x543519841x1702240317x1713910371x1701667186x779317072x539631736x540356144x774905899x1713384501x1701667186x779317072x539631737x540356144x774905899x171649333x538976288x1954047348x1130721909x1685221231x1952542313x540876901x1970302569x2019906676x1701999988x1919905603x1634625892x171664756x125x"), BaseFilter.nativeDecrypt("mee2959x1667592816x1869181801x1768431726x544237671x1634692198x1980382068x1769566817x1981835118x540173157x1986945379x1866691425x1768190575x1702125934x1635125819x1852406130x1702240359x1948267107x1970567269x1866687858x1768190575x1702125934x1963592251x1868982638x1931505010x1819307361x1144156773x1886284064x1833530485x1415931745x1970567269x171664754x1718185589x544043631x1886216563x846357868x1852383300x1232369008x1701273965x1954047316x845509237x1853164091x1919903337x1634934893x1701605485x541340274x1970302569x1634552180x1700029799x1920300152x171651941x1718185589x544043631x1886216563x846357868x1852383300x1232369008x1701273965x1954047316x879063669x1963592251x1868982638x1713401202x1952542572x1886150944x171663720x1667593738x1818370100x1130655333x1919904879x1667593768x1702109236x1819231096x539783791x878929270x1851876128x1131635062x1919904879x1852383276x1818370164x1298427493x694510703x537557770x1981816864x540238693x1701728118x1981824288x674456421x741355057x808333600x774971436x171649328x538976288x862152054x1700427296x1025535858x1667593760x774907955x807414832x539766830x691023408x538970683x791617568x1702258034x1881175154x1830839666x1769237621x175729776x538976288x1948804713x1866692709x779251564x540942433x691023408x538970747x538976288x2019914784x1869377347x1735536242x540876898x1131963764x1919904879x1650946606x1948266272x1866692709x779251564x537541473x2099257376x538976266x1667593760x1701978163x1953265011x1701998406x1948269856x1866692709x779251564x996304754x538976266x543582496x1701601832x1867342958x1008756068x691085373x791617659x1634100580x745827445x1852404512x1965057379x543450483x1953722221x1970282540x1852776564x1886352416x538970634x545071136x1702063205x543582496x1701601832x1867342958x1025533284x691150909x538999584x1970089775x1885959276x537557356x538976288x1914708000x1819636581x1919895156x540876901x1986945379x1866691425x779251564x543319922x1702109226x1819231096x1915646575x171663975x538976288x1818566781x1763730803x1646796902x1684956524x1701080909x540884256x544942390x790634528x1718580015x1734962292x537556072x538976288x1914708000x1819636581x1919895156x540876901x540028466x1633886250x1935767150x1869377347x1735536242x539631714x1131963764x1919904879x1650946606x1663052576x1635151457x1819231091x1915646575x706765415x1851876128x1131635062x1919904879x1650946606x673196576x1701728118x840969504x706752558x2019914784x1869377347x1735536242x171649378x538976288x538976288x673212009x1131963764x1919904879x1042313774x774905917x2065705269x538976266x538976288x538976288x1936028192x1182035061x778400367x540876914x540028466x1633886250x1935767150x1869377347x544353906x824713258x757084206x2019914784x1869377347x695348850x673196832x540028466x1702109226x1819231096x1915646575x824192288x539570222x1903370282x1663595634x1635151457x1819231091x1915646575x537541417x538976288x2099257376x538976266x538976288x543582496x2019914792x1869377347x543633010x807419198x539571502x538970747x538976288x538976288x1701978144x1953265011x1701998406x1025533742x808333856x1663052320x1635151457x1819231091x1731097199x673196576x540028465x1702109229x1819231096x1731097199x539697193x808333864x1948264992x1866692709x779251564x539828327x691023409x1931487776x678720113x1986945379x1866691425x779251564x171649383x538976288x538976288x538970749x538976288x1718165536x1702111264x1819231096x1647211119x540884512x691351088x537557792x538976288x538976288x1914708000x1819636581x1919895156x543305317x775036989x539631664x1986945379x1866691425x779251564x539631714x808333608x1948265760x1866692709x779251564x723528034x775039008x539631664x1131963764x1919904879x757097006x808333600x539631657x1953657203x1851876136x1131635062x1919904879x992567854x538976266x538976288x537558304x2099257376x538976266x1882140448x1830839666x1769237621x544828528x544370534x1816292455x1180986981x174288501x538976288x878929270x1936028192x1131703413x1919904879x1981824288x674521957x1970496882x1866888300x706766194x2019914784x1869377347x744566386x2019914784x1869377347x694234738x537528891x1914708000x1819636581x1819231092x1025536623x1667593760x1701980212x1953265011x1869377347x1735536242x539631714x540028465x1633886251x1935767150x1869377347x1735536242x539631714x808333608x1914711328x1819636581x1819231092x1630433903x824192041x992555054x538970634x1701978144x1852994932x1936028192x1131703413x1919904879x175966779x1768912394x1634541668x1982361193x694446447x537557792x1981816864x540304229x1986945379x1866691425x544370540x1702109245x1920300152x675557989x1970302569x1634552180x1700029799x1920300152x1663052901x1635151457x1869562739x1852400754x694514785x538970683x1702240288x1931490403x1282696815x1952999273x1131963732x1919904879x1948269856x1970567269x1144153458x1886284072x1833530485x1415931745x1970567269x741500274x2019914784x1701999988x1919905603x1634625892x992568692x538976266x1667593760x1970085940x1885959276x1700034924x1819231096x1025536623x2019914784x1701999988x1764246578x1953853550x1734438217x2019906661x1701999988x1948265523x1970567269x1866687858x1768190575x1702125934x537541417x1981816864x540304229x1836216174x1700031585x1819231096x1025536623x2019914784x1701999988x1764246578x1953853550x1734438217x2019906661x1701999988x1948265524x1970567269x1866687858x1768190575x1702125934x168442665x538976288x673212009x1952870259x1751607628x2019906676x1869377347x543239794x774905918x2065705264x538976266x538976288x1718580000x1734954100x1700033640x1819231096x1025536623x1718580000x1734954100x1700033640x1819231096x790655599x1667593760x1869817908x1766618214x1416915047x1866692709x779251564x1931488353x1282696815x1952999273x1131963732x1919904879x539779374x1952870259x1751607628x2019906676x1869377347x744566386x808333600x537541417x2099257376x538976266x1718580000x1734954100x1700033640x1819231096x1630433903x1931492640x1282696815x1952999273x1131963732x1919904879x706765102x1886150944x171663720x538976266x1718580000x1734954100x1700033640x1819231096x1915646575x1025532519x1718580000x1734954100x1700033640x1819231096x1915646575x706765415x1718580000x1734954100x1700033640x1819231096x1630433903x537528891x1763713056x1831346278x1769237621x1417243760x1866692709x779251564x540942433x691023408x537557792x538976288x1830821920x1769237621x1417243760x1866692709x544370540x1970085949x1885959276x1700034924x1819231096x790655599x1667593760x1970087988x1885959276x1700034924x1819231096x1630433903x1970085932x1885959276x1700034924x1819231096x1630433903x1970085932x1885959276x1700034924x1819231096x1630433903x774971436x171649328x538976288x538970749x1970085920x1885959276x1700034924x1819231096x1630433903x1830829344x1769237621x1417243760x1866692709x779251564x539631713x1752198241x168442721x538976288x1953265005x2037149801x1131963732x1919904879x1650946606x1830829344x1769237621x1417243760x1866692709x779251564x543319922x1970085930x1885959276x1700034924x1819231096x1630433903x537528891x1763713056x1848123494x1634562671x2019906668x1869377347x543239794x774905918x2065705264x538976266x538976288x1919905312x1416388973x1866692709x544370540x1869488189x1818324338x1131963732x1919904879x1981820704x674521957x1836216174x1700031585x1819231096x1630433903x1869488172x1818324338x1131963732x1919904879x539779374x1836216174x1700031585x1819231096x1630433903x774971436x171649328x538976288x538970749x1869488160x1818324338x1131963732x1919904879x1025532206x1919905312x1416388973x1866692709x779251564x539631713x1752198241x168442721x538976288x1836216174x1700031585x1819231096x1915646575x1025532519x1919905312x1416388973x1866692709x779251564x543319922x1869488170x1818324338x1131963732x1919904879x171663662x538970634x1702240288x1914713187x1819636581x1819231092x1025536623x1701601824x1866687598x678588268x1952870259x1751607628x2019906676x1869377347x1663052914x1635151457x1819231091x539783791x171649334x538976288x1970496882x1866691692x544370540x1818370109x1130655333x1919904879x1819634984x1819306356x2019906681x1869377347x1914711154x1819636581x1819231092x539783791x171649330x538976288x1180658791x1130848626x1919904879x1646279968x1684956524x1869377347x1869490290x1818324338x1131963732x1919904879x1701978156x1953265011x1869377347x824192114x168442665x687392x"));
    this.dataPath = "assets://realtimeBeauty";
    initParams();
    this.sampleSize = decodeBitmaps();
  }
  
  private FaceItem createFaceItem()
  {
    return (FaceItem)VideoTemplateParser.parseVideoMaterial("assets://realtimeBeauty", "{\n  \"minAppVersion\": 400,\n  \"shaderType\": 5,\n  \"maxFaceCount\": 10,\n  \"faceOffType\": 0,\n  \"faceOffItemList\": [\n  {\n    \"faceExchangeImage\": \"beauty_normal.png\",\n    \"blendAlpha\":1.0,\n    \"featureType\": 0,\n    \"grayScale\": 0,\n\t\"blendMode\": 1,\n\t\"facePoints\": [\n156.88185140529998, 528.1364190166,\n  169.5493300902, 595.3714981903,\n  181.24238733779998, 649.9390986791,\n  191.9610231481, 695.7369062322,\n  214.372716206, 738.6114494734,\n  238.7332521385, 776.6138855281,\n  277.71010963049997, 811.6930572709,\n  311.814859936, 843.8489647018,\n  351.7661388653, 868.2095006343,\n  398.53836785569996, 876.97929357,\n  445.3105968461, 866.2606577596999,\n  491.10840439919997, 841.9001218272,\n  528.1364190166, 807.7953715217,\n  558.3434835729, 769.792935467,\n  585.6272838172999, 734.7137637242,\n  605.1157125633, 690.8647990457,\n  618.7576126855, 645.0669914926,\n  630.4506699331, 592.4482338784,\n  633.373934245, 524.2387332674,\n  199.75639464649998, 446.2850182834,\n  239.7076735758, 444.3361754088,\n  280.6333739424, 448.23386115799997,\n  321.559074309, 456.0292326564,\n  362.48477467559997, 458.9524969683,\n  327.4056029328, 433.6175395985,\n  283.55663825429997, 425.8221681001,\n  239.7076735758, 425.8221681001,\n  595.3714981903, 445.3105968461,\n  555.4202192609999, 444.3361754088,\n  515.4689403317, 452.1315469072,\n  484.28745433809996, 457.0036540937,\n  438.489646785, 460.9013398429,\n  464.7990255921, 435.56638247309996,\n  508.64799027059996, 422.89890378819996,\n  559.3179050102, 422.89890378819996,\n  241.6565164504, 506.699147396,\n  260.1705237591, 518.3922046435999,\n  285.5054811289, 522.2898903928,\n  309.8660170614, 520.3410475182,\n  336.1753958685, 511.5712545825,\n  317.6613885598, 493.0572472738,\n  287.4543240035, 483.3130329008,\n  263.093788071, 489.1595615246,\n  291.3520097527, 504.7503045214,\n  291.3520097527, 502.80146164679996,\n  558.3434835729, 501.8270402095,\n  537.8806333896, 516.443361769,\n  511.5712545825, 523.2643118300999,\n  487.21071865, 521.3154689555,\n  460.9013398429, 512.5456760198,\n  481.3641900262, 492.0828258365,\n  508.64799027059996, 484.28745433809996,\n  534.9573690777, 488.1851400873,\n  508.64799027059996, 502.80146164679996,\n  508.64799027059996, 500.8526187722,\n  370.280146174, 512.5456760198,\n  366.3824604248, 600.2436053768,\n  340.0730816177, 649.9390986791,\n  370.280146174, 668.4531059878,\n  400.4872107303, 672.350791737,\n  428.745432412, 666.5042631132,\n  458.9524969683, 647.0158343672,\n  432.6431181612, 601.2180268141,\n  430.6942752866, 513.5200974571,\n  400.4872107303, 636.2971985569,\n  312.7892813733, 719.1230207274,\n  489.1595615246, 717.1741778528,\n  335.2009744312, 743.4835566598999,\n  364.4336175502, 759.0742996567,\n  399.51278929299997, 766.8696711550999,\n  434.5919610358, 758.0998782194,\n  464.7990255921, 741.5347137853,\n  442.38733253419997, 736.6626065987999,\n  401.4616321676, 741.5347137853,\n  352.7405603026, 736.6626065987999,\n  346.8940316788, 713.2764921035999,\n  379.0499391097, 710.3532277917,\n  401.4616321676, 714.2509135409,\n  421.9244823509, 713.2764921035999,\n  454.08038978179997, 713.2764921035999,\n  442.38733253419997, 729.8416565377,\n  400.4872107303, 731.7904994122999,\n  354.6894031772, 727.8928136631,\n  400.4872107303, 512.5456760198,\n  404.3848964795, 460.9013398429,\n  400.4872107303, 692.8136419203,\n  205.60292327029998, 205.60292327029998,\n  398.53836785569996, 275.7612667559,\n  598.2947625022, 197.8075517719,\n  400.4872107303, 356.63824605179997\n    ]\n  }\n  \n  ]\n}\n\n", null).getFaceOffItemList().get(0);
  }
  
  private int decodeBitmaps()
  {
    this.softLightBitmap = BitmapUtils.decodeSampleBitmapFromAssets(AEModule.getContext(), FileUtils.getRealPath(this.dataPath + File.separator + "beauty_softlight.png"), 1);
    this.multiplyBitmap = BitmapUtils.decodeSampleBitmapFromAssets(AEModule.getContext(), FileUtils.getRealPath(this.dataPath + File.separator + "beauty_multiply.png"), 1);
    this.normalBitmap = BitmapUtils.decodeSampleBitmapFromAssets(AEModule.getContext(), FileUtils.getRealPath(this.dataPath + File.separator + "beauty_normal.png"), 1);
    return 1;
  }
  
  private boolean initFaceImage()
  {
    if (this.isFaceImageReady) {
      return true;
    }
    if (BitmapUtils.isLegal(this.softLightBitmap))
    {
      GlUtil.loadTexture(this.texture[0], this.softLightBitmap);
      this.faceImageWidth = (this.softLightBitmap.getWidth() * this.sampleSize);
      this.faceImageHeight = (this.softLightBitmap.getHeight() * this.sampleSize);
      initFaceTexCoords();
      addParam(new UniformParam.TextureParam("inputImageTexture2", this.texture[0], 33986));
      this.isFaceImageReady = true;
    }
    if (BitmapUtils.isLegal(this.multiplyBitmap))
    {
      GlUtil.loadTexture(this.texture[1], this.multiplyBitmap);
      addParam(new UniformParam.TextureParam("inputImageTexture3", this.texture[1], 33987));
      this.isFaceImageReady = true;
    }
    if (BitmapUtils.isLegal(this.normalBitmap))
    {
      GlUtil.loadTexture(this.texture[2], this.normalBitmap);
      addParam(new UniformParam.TextureParam("inputImageTexture4", this.texture[2], 33988));
      this.isFaceImageReady = true;
    }
    return this.isFaceImageReady;
  }
  
  private void initFaceTexCoords()
  {
    setTexCords(FaceOffUtil.initMaterialFaceTexCoords(FaceOffUtil.getFullCoords(FaceOffUtil.genPoints(this.item.facePoints), 2.0F), this.faceImageWidth, this.faceImageHeight, this.texVertices));
  }
  
  public void ApplyGLSLFilter()
  {
    super.ApplyGLSLFilter();
    GLES20.glGenTextures(this.texture.length, this.texture, 0);
  }
  
  public void clearGLSLSelf()
  {
    GLES20.glDeleteTextures(this.texture.length, this.texture, 0);
    this.isFaceImageReady = false;
    BitmapUtils.recycle(this.softLightBitmap);
    BitmapUtils.recycle(this.multiplyBitmap);
    BitmapUtils.recycle(this.normalBitmap);
    LogUtils.d(TAG, "[clearGLSLSelf] delete texture, recycle bmp");
    super.clearGLSLSelf();
  }
  
  public void initAttribParams()
  {
    super.initAttribParams();
    initFaceTexCoords();
    setDrawMode(AEOpenRenderConfig.DRAW_MODE.TRIANGLES);
    setCoordNum(690);
  }
  
  public void initParams()
  {
    this.faceImageWidth = this.item.width;
    this.faceImageHeight = this.item.height;
    addParam(new UniformParam.TextureParam("inputImageTexture2", 0, 33986));
    addParam(new UniformParam.TextureParam("inputImageTexture3", 0, 33987));
    addParam(new UniformParam.TextureParam("inputImageTexture4", 0, 33988));
    addParam(new UniformParam.FloatParam("alpha", this.alpha));
    addParam(new UniformParam.Float2fParam("canvasSize", this.width, this.height));
    addParam(new UniformParam.FloatParam("positionRotate", 0.0F));
  }
  
  public boolean needRender()
  {
    return this.alpha > 0.01F;
  }
  
  public boolean renderTexture(int paramInt1, int paramInt2, int paramInt3)
  {
    AttributeParam localAttributeParam = getAttribParam("position");
    if ((localAttributeParam == null) || (localAttributeParam.vertices.length / localAttributeParam.perVertexFloat != 690)) {}
    do
    {
      return false;
      localAttributeParam = getAttribParam("inputTextureCoordinate");
    } while ((localAttributeParam == null) || (localAttributeParam.vertices.length / localAttributeParam.perVertexFloat != 690));
    return super.renderTexture(paramInt1, paramInt2, paramInt3);
  }
  
  public void setAlphaValue(float paramFloat)
  {
    this.alpha = paramFloat;
    addParam(new UniformParam.FloatParam("alpha", this.alpha));
  }
  
  public void updatePointParams(List<PointF> paramList)
  {
    setPositions(FaceOffUtil.initFacePositions(FaceOffUtil.getFullCoords(VideoMaterialUtil.copyList(paramList), 2.0F), (int)(this.width * this.mFaceDetScale), (int)(this.height * this.mFaceDetScale), this.faceVertices));
    setCoordNum(690);
  }
  
  public void updatePreview(Object paramObject)
  {
    if ((paramObject instanceof PTDetectInfo))
    {
      paramObject = (PTDetectInfo)paramObject;
      updatePointParams(VideoMaterialUtil.copyList(paramObject.facePoints));
      updateTextureParams(paramObject.timestamp);
    }
  }
  
  public void updateTextureParams(long paramLong)
  {
    initFaceImage();
  }
  
  public void updateVideoSize(int paramInt1, int paramInt2, double paramDouble)
  {
    super.updateVideoSize(paramInt1, paramInt2, paramDouble);
    addParam(new UniformParam.Float2fParam("canvasSize", paramInt1, paramInt2));
  }
}


/* Location:           L:\local\mybackup\temp\qq_apk\com.tencent.mobileqq\classes10.jar
 * Qualified Name:     com.tencent.ttpic.filter.FaceFeatureFilterReshape
 * JD-Core Version:    0.7.0.1
 */