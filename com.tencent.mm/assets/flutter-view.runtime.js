System.register(["./flutter-view.base.js"],(function(){"use strict";var e,t,n,r,s,i,o,a,c,l,h,u,d,p,f,g,m,b,v,y,C,S,M,w,I,x,E,_,j,A,O,P,N,T,D,L,k,R,$;return{setters:[function(q){e=q.g,t=q.a,n=q.o,r=q.c,s=q._,i=q.b,o=q.d,a=q.e,c=q.t,l=q.i,h=q.f,u=q.w,d=q.h,p=q.j,f=q.k,g=q.l,m=q.m,b=q.n,v=q.p,y=q.q,C=q.r,S=q.s,M=q.u,w=q.v,I=q.x,x=q.y,E=q.z,_=q.A,j=q.B,A=q.C,O=q.D,P=q.E,N=q.F,T=q.G,D=q.H,L=q.I,k=q.J,R=q.K,$=q.L}],execute:function(){var q;function B(e){return void 0===e}function V(e){return"[object Object]"===Object.prototype.toString.call(e)}function H(e){return V(e)}function U(e){return"[object Array]"===Object.prototype.toString.call(e)}function F(e){return"[object String]"===Object.prototype.toString.call(e)}function W(e){return"[object Function]"===Object.prototype.toString.call(e)}function K(e,...t){console[e](t.map((e=>V(e)||U(e)?JSON.stringify(e):e)).join(" "))}!function(e){e.callback="callback",e.fireDomEvent="fireDomEvent",e.globalEvent="globalEvent",e.syncCall="syncCall"}(q||(q={}));class z{constructor(e){this.tag="base",this.tag=e}log(...e){K("log",[this.tag],e)}info(...e){K("info",[this.tag],e)}warn(...e){K("warn",[this.tag],e)}error(...e){K("error",[this.tag],e)}debug(...e){K("debug",[this.tag],e)}timeoutInfo(e,...t){setTimeout((()=>{K("info",[this.tag],t)}),e)}}const J=new z("runtime");new z("bridge"),new z("develop");class G{constructor(e,t,n={}){this.handleMap={},this.isDestroy=!1,this.instance=e,this.afterReceiveHook=n.afterReceiveHook,t.forEach((e=>{this.handleMap[e.name]=e.handler}))}destroy(){this.isDestroy=!0}receive(t){if(this.isDestroy)return void J.error("实例已经销毁，无法接收调用");if(!this.instance.isReady)throw new Error("实例未加载");let n=[];for(let r of t){let t,s=this.handleMap[r.name];if(s)try{t=s(this.instance,...r.args||[])}catch(t){e().baseLibApi.reportError(this.instance.id,t.name,t.message,t.stack),this.instance.receiver.receive([{name:q.globalEvent,args:["error",[t,"uncaughtException"]]}])}n.push(t)}return this.afterReceiveHook&&this.afterReceiveHook(),JSON.stringify(n)}}const X=["runInInstance","createInstance","destroyInstance","callJS","register","setUp","liteAppVDom","reporter","setRuntimeConfig","baseLibApi"];var Q,Z;!function(e){e.string="string",e.number="number",e.boolean="boolean",e.json="json",e.object="object",e.callback="callback",e.raw="raw"}(Q||(Q={})),function(e){e.raw="raw",e.json="json",e.promise="promise",e.string="string"}(Z||(Z={}));const Y={[Q.string]:"",[Q.number]:0,[Q.boolean]:!1,[Q.object]:void 0,[Q.callback]:-1,[Q.json]:"{}",[Q.raw]:void 0};var ee,te;!function(e){e.module="module",e.component="component"}(ee||(ee={}));class ne{constructor(){this.modulesInfo={},this.componentsInfo={}}static getInstance(){return ne.instance||(ne.instance=new ne),ne.instance}get publicModuleNames(){let e=[];for(const[t,n]of Object.entries(this.modulesInfo))n.private||e.push(t);return e}register(e){for(const t of e)switch(t.type){case ee.module:this.registerModules(t.info);break;case ee.component:this.registerComponents(t.info)}}registerComponents(e){for(let t in e)e.hasOwnProperty(t)&&(this.componentsInfo[t]=e[t])}registerModules(e){for(let t in e)if(e.hasOwnProperty(t)){const n=e[t],r=n.bridge;this.modulesInfo[t]=n,"global"===r.type&&X.indexOf(r.name)<0&&X.push(r.name)}}}!function(e){e.dom="dom",e.domMethod="domMethod",e.global="global",e.dynamic="dynamic",e.component="component"}(te||(te={}));class re extends class{constructor(e){this.callBuffer=[],this.isReady=!1,this.isDestroy=!1,this.callbackManager=e.callbackManager,this.instance=e.instance,this.startUp()}startUp(){this.instance.isReady&&(this.isReady=!0,this.Promise=this.instance.injectContext.Promise,this.callBuffer.forEach((e=>{this.callApi(e.apiType,e.params)})))}destroy(){this.isDestroy=!0}callApi(e,t){if(!this.isDestroy){if(this.isReady)return this.taskExecution(e,t);this.callBuffer.push({apiType:e,params:t})}}taskExecution(t,n){if(t===te.dynamic){let t=n,r=e();return this.commonCallMethod(r,r.callDynamicModule,t,[t.moduleName,t.method],!0)}if(t===te.global){let e=n;return this.callGlobalMethod(e)}}serializeArgument(e){switch(typeof e){case"object":if(e instanceof Array)return this.serializeArgumentArray(e);{let t={};for(let n in e)void 0!==e[n]&&(t[n]=this.serializeArgument(e[n]));return t}case"function":return this.callbackManager.add(e);default:return e}}serializeArgumentArray(e){const t=[];for(let n of e)t.push(this.serializeArgument(n));return t}serializeArgumentArrayWithDefinition(e,t){const n=[];return t.forEach(((t,r)=>{const s=e[r];n.push(this.serializeArgumentWithDefinition(s,t,r.toString()))})),n}serializeArgumentWithDefinition(e,t,n){if(B(e)){if(!B(t.defaultValue))return t.defaultValue;if(t.optional)return Y[t.type];throw new Error(`缺少参数 ${n}`)}if(t.type===Q.object)return t.props?this.serializeArgumentObjectWithDefinition(e,t.props):e;switch(t.type){case Q.callback:return this.callbackManager.add(e);case Q.json:return JSON.stringify(e);default:return e}}serializeArgumentObjectWithDefinition(e,t){const n={};for(const r in t){let s=e[r];n[r]=this.serializeArgumentWithDefinition(s,t[r],r)}return n}argumentToStringArray(e){for(let t=0;t<e.length;t++){let n=e[t];n?V(n)?e[t]=JSON.stringify(n):e[t]=n.toString():e[t]=""}return e}commonCallMethod(e,t,n,r=[],s=!1){var i,o;let a=n.args||[],c=a;const l=(null===(i=n.methodInfo)||void 0===i?void 0:i.params)||[];n.methodInfo&&(c.length,l.length,c=this.serializeArgumentArrayWithDefinition(a,l)),s&&(c=[this.argumentToStringArray(c)]),c=null==r?void 0:r.concat(c);let h=null===(o=n.methodInfo)||void 0===o?void 0:o.result;if(h&&h.type===Z.promise){let n;if(a.length>l.length&&W(a[l.length])&&(n=a[l.length]),n){let r=this.callbackManager.add(n);return c.push(r),c.unshift(this.instance.id),t.apply(e,c)}return new this.Promise(((n,r)=>{let s=this.callbackManager.add(((e,t)=>{e?r(e):n(t)}));return c.push(s),c.unshift(this.instance.id),t.apply(e,c)}))}{c.unshift(this.instance.id);let n=t.apply(e,c);return h&&h.type===Z.json&&(n=JSON.parse(n)),n}}callGlobalMethod(t){const n=e()[t.globalKey];if(!n)throw new Error(`全局对象 ${t.globalKey} 不存在`);if(!n[t.method])throw new Error(`全局对象 ${t.globalKey} 的方法 ${t.method} 不存在`);return this.commonCallMethod(n,n[t.method],t)}}{constructor(t){super(t),this.liteAppVDom=e().liteAppVDom}taskExecution(e,t){var n,r;let s=t.args||[];switch(e){case te.dom:let i=this.serializeArgumentArray(s);return i.unshift(this.instance.id),this.liteAppVDom[t.method].apply(this.liteAppVDom,i);case te.domMethod:let o=t,a=s;const c=(null===(n=o.methodInfo)||void 0===n?void 0:n.params)||[];o.methodInfo&&(a.length,c.length,a=this.serializeArgumentArrayWithDefinition(s,c));let l=null===(r=o.methodInfo)||void 0===r?void 0:r.result;if(l&&l.type===Z.promise){let e;if(s.length>c.length&&W(s[c.length])&&(e=s[c.length]),e){let t=this.callbackManager.add(e);return a.push(t),this.liteAppVDom.callMethod(this.instance.id,o.nodeId,o.method,JSON.stringify(a))}return new this.Promise(((e,t)=>{let n=this.callbackManager.add(((n,r)=>{n?t(n):e(r)}));return a.push(n),this.liteAppVDom.callMethod(this.instance.id,o.nodeId,o.method,JSON.stringify(a))}))}{let e=this.liteAppVDom.callMethod(this.instance.id,o.nodeId,o.method,JSON.stringify(a));return l&&l.type===Z.json&&(e=JSON.parse(e)),e}default:return super.taskExecution(e,t)}}}class se{constructor(){this.lastCallbackId=0,this.callbacks=[]}add(e){this.lastCallbackId<1e9?this.lastCallbackId++:this.lastCallbackId=1;let t=this.lastCallbackId;return this.callbacks[t]=e,e.__dispose=()=>{this.remove(t)},t}remove(e){let t;if(n=e,"[object Number]"===Object.prototype.toString.call(n))t=this.callbacks[e],delete this.callbacks[e];else{const n=this.callbacks.findIndex(e);t=this.callbacks[n],delete this.callbacks[n]}var n;return t}trigger(e,t,n=!1){const r=this.callbacks[e];if(n||delete this.callbacks[e],"function"==typeof r)return U(t)?r.apply(null,t):r.call(null,t);throw new Error("callback not found: "+e)}destroy(){this.callbacks=[]}}function ie(e,t){for(const n in t){const r=t[n];B(e[n])&&!B(r)&&(e[n]=r)}return e}let oe={},ae={};function ce(e){return oe[e]||(oe[e]=e.replace(/-([a-z])/g,((e,t)=>t.toUpperCase()))),oe[e]}function le(e){return ae[e]||(ae[e]=e.replace(/([A-Z])/g,((e,t)=>`-${t.toLowerCase()}`))),ae[e]}const he={stringify(e){let t="";for(const n in e)t=t+"&"+n+"="+(B(e[n])?"":e[n].toString());return t.slice(1)},parse(e){if(!e)return{};const t=e.split("&"),n={};for(const e of t){let[t,r]=e.split("=");n[t]=r}return n}};function ue(e){let t=!1;return function(...n){t||(e(...n),t=!0)}}var de,pe,fe,ge;!function(e){e.routeEnter="routeEnter",e.load="load",e.ready="ready",e.show="show",e.hide="hide",e.unload="unload",e.reachBottom="reachBottom",e.error="error"}(de||(de={})),function(e){e.load="load",e.unload="unload",e.viewVisibilityChange="viewVisibilityChange",e.viewEnter="viewEnter",e.viewLeave="viewLeave",e.pageEnter="pageEnter",e.pageLeave="pageLeave",e.pagePreload="pagePreload"}(pe||(pe={})),function(e){e.dispatch="connect.dispatch",e.subscribe="connect.subscribe",e.unsubscribe="connect.unsubscribe",e.data="connect.data"}(fe||(fe={})),function(e){e.share="app.shareMessage"}(ge||(ge={}));class me{constructor(e,t){this.event={},this.skipDeferEvent={},this.deferDispatchList=[],this.defer=!1,this.dispatchBacktrackingHistory=[],this.baseLibApi=e.requirePrivateModule("baseLibApi"),t&&(this.defer=t.defer)}addEventListener(e,t,n=!1){this.actionInject&&this.actionInject(e);let r=this.event[e];r||(r=this.event[e]=[]),t.skipDefer=n,r.push(t),1===r.length&&this.baseLibApi.subscribeEvent(e),this.flushBacktrackingEvent(e,t)}removeEventListener(e,t){const n=this.event[e];if(n&&n.length){if(t){const e=n.findIndex((e=>e===t));e>=0&&n.splice(e,1)}else n.splice(0,n.length);0===n.length&&this.baseLibApi.unSubscribeEvent(e)}}flushDeferEvent(){this.defer=!1;for(const e of this.deferDispatchList)this.dispatchEvent(e.type,e.args)}dispatchEvent(e,t,n={}){var r,s,i;this.defer&&this.deferDispatchList.push({type:e,args:t}),(r=e)in de||r in pe||(s=fe,i=r,Object.keys(s).map((e=>s[e])).findIndex((e=>e===i)));const o=this.event[e];if(!this.defer&&n.backtracking&&this.dispatchBacktrackingHistory.push({type:e,args:t,backtracking:!0}),o){const n=[...o];for(const r of n)this.defer?r.skipDefer&&(r(...t),this.removeEventListener(e,r)):r(...t)}}destroy(){this.event={}}flushBacktrackingEvent(e,t){setTimeout((()=>{this.dispatchBacktrackingHistory.forEach((n=>{n.type===e&&t(...n.args)}))}),1)}}const be={globalKey:"base",method:"loadLib",methodInfo:{name:"loadLib",params:[{type:Q.string},{type:Q.callback}]}};class ve{constructor(e){this.instance=e}loadLib(e,t){return this.instance.apiCenter.callApi(te.global,Object.assign(Object.assign({},be),{args:[e,t]}))}}t().Promise,t().Promise={};var ye=function(e,t){var n=this;if(!(n instanceof ye))return new ye(e,t);i&&(n=i(new Error(void 0),o(n))),void 0!==t&&a(n,"message",c(t));var r=[];return l(e,r.push,{that:r}),a(n,"errors",r),n};ye.prototype=n(Error.prototype,{constructor:r(5,ye),message:r(5,""),name:r(5,"AggregateError")}),s({global:!0},{AggregateError:ye});var Ce=h.Promise,Se=u("species"),Me=u("iterator"),we=!1;try{var Ie=0,xe={next:function(){return{done:!!Ie++}},return:function(){we=!0}};xe[Me]=function(){return this},Array.from(xe,(function(){throw 2}))}catch(e){}var Ee,_e,je,Ae,Oe=/(?:iphone|ipod|ipad).*applewebkit/i.test(g),Pe="process"==m(h.process),Ne=h.setImmediate,Te=h.clearImmediate,De=h.process,Le=h.MessageChannel,ke=h.Dispatch,Re=0,$e={},qe="onreadystatechange";try{Ee=h.location}catch(e){}var Be=function(e){if($e.hasOwnProperty(e)){var t=$e[e];delete $e[e],t()}},Ve=function(e){return function(){Be(e)}},He=function(e){Be(e.data)},Ue=function(e){h.postMessage(String(e),Ee.protocol+"//"+Ee.host)};Ne&&Te||(Ne=function(e){for(var t=[],n=arguments.length,r=1;n>r;)t.push(arguments[r++]);return $e[++Re]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},_e(Re),Re},Te=function(e){delete $e[e]},Pe?_e=function(e){De.nextTick(Ve(e))}:ke&&ke.now?_e=function(e){ke.now(Ve(e))}:Le&&!Oe?(Ae=(je=new Le).port2,je.port1.onmessage=He,_e=b(Ae.postMessage,Ae,1)):h.addEventListener&&"function"==typeof postMessage&&!h.importScripts&&Ee&&"file:"!==Ee.protocol&&!v(Ue)?(_e=Ue,h.addEventListener("message",He,!1)):_e=qe in y("script")?function(e){C.appendChild(y("script")).onreadystatechange=function(){C.removeChild(this),Be(e)}}:function(e){setTimeout(Ve(e),0)});var Fe,We,Ke,ze,Je,Ge,Xe,Qe,Ze={set:Ne,clear:Te},Ye=/iphone|ipod|ipad/i.test(g)&&void 0!==h.Pebble,et=/web0s(?!.*chrome)/i.test(g),tt=S.f,nt=Ze.set,rt=h.MutationObserver||h.WebKitMutationObserver,st=h.document,it=h.process,ot=h.Promise,at=tt(h,"queueMicrotask"),ct=at&&at.value;ct||(Fe=function(){var e,t;for(Pe&&(e=it.domain)&&e.exit();We;){t=We.fn,We=We.next;try{t()}catch(e){throw We?ze():Ke=void 0,e}}Ke=void 0,e&&e.enter()},Oe||Pe||et||!rt||!st?!Ye&&ot&&ot.resolve?((Xe=ot.resolve(void 0)).constructor=ot,Qe=Xe.then,ze=function(){Qe.call(Xe,Fe)}):ze=Pe?function(){it.nextTick(Fe)}:function(){nt.call(h,Fe)}:(Je=!0,Ge=st.createTextNode(""),new rt(Fe).observe(Ge,{characterData:!0}),ze=function(){Ge.data=Je=!Je}));var lt,ht,ut,dt,pt=ct||function(e){var t={fn:e,next:void 0};Ke&&(Ke.next=t),We||(We=t,ze()),Ke=t},ft=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=M(t),this.reject=M(n)},gt={f:function(e){return new ft(e)}},mt=function(e,t){if(w(e),I(t)&&t.constructor===e)return t;var n=gt.f(e);return(0,n.resolve)(t),n.promise},bt=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},vt="object"==typeof window,yt=Ze.set,Ct=u("species"),St="Promise",Mt=T.get,wt=T.set,It=T.getterFor(St),xt=Ce&&Ce.prototype,Et=Ce,_t=xt,jt=h.TypeError,At=h.document,Ot=h.process,Pt=gt.f,Nt=Pt,Tt=!!(At&&At.createEvent&&h.dispatchEvent),Dt="function"==typeof PromiseRejectionEvent,Lt="unhandledrejection",kt=!1,Rt=x(St,(function(){var e=A(Et),t=e!==String(Et);if(!t&&66===O)return!0;if(O>=51&&/native code/.test(e))return!1;var n=new Et((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};return(n.constructor={})[Ct]=r,!(kt=n.then((function(){}))instanceof r)||!t&&vt&&!Dt})),$t=Rt||!function(e,t){if(!t&&!we)return!1;var n=!1;try{var r={};r[Me]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n}((function(e){Et.all(e).catch((function(){}))})),qt=function(e){var t;return!(!I(e)||"function"!=typeof(t=e.then))&&t},Bt=function(e,t){if(!e.notified){e.notified=!0;var n=e.reactions;pt((function(){for(var r=e.value,s=1==e.state,i=0;n.length>i;){var o,a,c,l=n[i++],h=s?l.ok:l.fail,u=l.resolve,d=l.reject,p=l.domain;try{h?(s||(2===e.rejection&&Ft(e),e.rejection=1),!0===h?o=r:(p&&p.enter(),o=h(r),p&&(p.exit(),c=!0)),o===l.promise?d(jt("Promise-chain cycle")):(a=qt(o))?a.call(o,u,d):u(o)):d(r)}catch(e){p&&!c&&p.exit(),d(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&Ht(e)}))}},Vt=function(e,t,n){var r,s;Tt?((r=At.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),h.dispatchEvent(r)):r={promise:t,reason:n},!Dt&&(s=h["on"+e])?s(r):e===Lt&&function(e,t){var n=h.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))}("Unhandled promise rejection",n)},Ht=function(e){yt.call(h,(function(){var t,n=e.facade,r=e.value;if(Ut(e)&&(t=bt((function(){Pe?Ot.emit("unhandledRejection",r,n):Vt(Lt,n,r)})),e.rejection=Pe||Ut(e)?2:1,t.error))throw t.value}))},Ut=function(e){return 1!==e.rejection&&!e.parent},Ft=function(e){yt.call(h,(function(){var t=e.facade;Pe?Ot.emit("rejectionHandled",t):Vt("rejectionhandled",t,e.value)}))},Wt=function(e,t,n){return function(r){e(t,r,n)}},Kt=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,Bt(e,!0))},zt=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw jt("Promise can't be resolved itself");var r=qt(t);r?pt((function(){var n={done:!1};try{r.call(t,Wt(zt,n,e),Wt(Kt,n,e))}catch(t){Kt(n,t,e)}})):(e.value=t,e.state=1,Bt(e,!1))}catch(t){Kt({done:!1},t,e)}}};if(Rt&&(_t=(Et=function(e){P(this,Et,St),M(e),lt.call(this);var t=Mt(this);try{e(Wt(zt,t),Wt(Kt,t))}catch(e){Kt(t,e)}}).prototype,(lt=function(e){wt(this,{type:St,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=E(_t,{then:function(e,t){var n=It(this),r=Pt(N(this,Et));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=Pe?Ot.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&Bt(n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),ht=function(){var e=new lt,t=Mt(e);this.promise=e,this.resolve=Wt(zt,t),this.reject=Wt(Kt,t)},gt.f=Pt=function(e){return e===Et||e===ut?new ht(e):Nt(e)},"function"==typeof Ce&&xt!==Object.prototype)){dt=xt.then,kt||(_(xt,"then",(function(e,t){var n=this;return new Et((function(e,t){dt.call(n,e,t)})).then(e,t)}),{unsafe:!0}),_(xt,"catch",_t.catch,{unsafe:!0}));try{delete xt.constructor}catch(e){}i&&i(xt,_t)}s({global:!0,wrap:!0,forced:Rt},{Promise:Et}),j(Et,St,!1),function(e){var t=d(e),n=p.f;f&&t&&!t[Se]&&n(t,Se,{configurable:!0,get:function(){return this}})}(St),ut=d(St),s({target:St,stat:!0,forced:Rt},{reject:function(e){var t=Pt(this);return t.reject.call(void 0,e),t.promise}}),s({target:St,stat:!0,forced:Rt},{resolve:function(e){return mt(this,e)}}),s({target:St,stat:!0,forced:$t},{all:function(e){var t=this,n=Pt(t),r=n.resolve,s=n.reject,i=bt((function(){var n=M(t.resolve),i=[],o=0,a=1;l(e,(function(e){var c=o++,l=!1;i.push(void 0),a++,n.call(t,e).then((function(e){l||(l=!0,i[c]=e,--a||r(i))}),s)})),--a||r(i)}));return i.error&&s(i.value),n.promise},race:function(e){var t=this,n=Pt(t),r=n.reject,s=bt((function(){var s=M(t.resolve);l(e,(function(e){s.call(t,e).then(n.resolve,r)}))}));return s.error&&r(s.value),n.promise}}),s({target:"Promise",stat:!0},{allSettled:function(e){var t=this,n=gt.f(t),r=n.resolve,s=n.reject,i=bt((function(){var n=M(t.resolve),s=[],i=0,o=1;l(e,(function(e){var a=i++,c=!1;s.push(void 0),o++,n.call(t,e).then((function(e){c||(c=!0,s[a]={status:"fulfilled",value:e},--o||r(s))}),(function(e){c||(c=!0,s[a]={status:"rejected",reason:e},--o||r(s))}))})),--o||r(s)}));return i.error&&s(i.value),n.promise}});var Jt="No one promise resolved";s({target:"Promise",stat:!0},{any:function(e){var t=this,n=gt.f(t),r=n.resolve,s=n.reject,i=bt((function(){var n=M(t.resolve),i=[],o=0,a=1,c=!1;l(e,(function(e){var l=o++,h=!1;i.push(void 0),a++,n.call(t,e).then((function(e){h||c||(c=!0,r(e))}),(function(e){h||c||(h=!0,i[l]=e,--a||s(new(d("AggregateError"))(i,Jt)))}))})),--a||s(new(d("AggregateError"))(i,Jt))}));return i.error&&s(i.value),n.promise}});var Gt=!!Ce&&v((function(){Ce.prototype.finally.call({then:function(){}},(function(){}))}));if(s({target:"Promise",proto:!0,real:!0,forced:Gt},{finally:function(e){var t=N(this,d("Promise")),n="function"==typeof e;return this.then(n?function(n){return mt(t,e()).then((function(){return n}))}:e,n?function(n){return mt(t,e()).then((function(){throw n}))}:e)}}),"function"==typeof Ce){var Xt=d("Promise").prototype.finally;Ce.prototype.finally!==Xt&&_(Ce.prototype,"finally",Xt,{unsafe:!0})}D.Promise;var Qt,Zt,Yt={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},en=u("iterator"),tn=u("toStringTag"),nn=L.values;for(var rn in Yt){var sn=h[rn],on=sn&&sn.prototype;if(on){if(on[en]!==nn)try{a(on,en,nn)}catch(e){on[en]=nn}if(on[tn]||a(on,tn,rn),Yt[rn])for(var an in L)if(on[an]!==L[an])try{a(on,an,L[an])}catch(e){on[an]=L[an]}}}s({target:"Promise",stat:!0},{try:function(e){var t=gt.f(this),n=bt(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}}),["finally","then","catch"].forEach((t=>{let n=Promise.prototype[t];Promise.prototype[t]=function(...t){let r=t.map((t=>t instanceof Function&&this.id?n=>{const r=t(n);return e().callJS(this.id,[]),r}:t)),s=n.call(this,...r);return s.id=this.id,s}})),function(e){e.connect="connect.syncCall"}(Qt||(Qt={}));class cn{constructor(){this.callMap={}}addHandler(e,t){if(this.callMap[e])throw new Error(`type:${e} 类型的 handler 已存在`);this.callMap[e]=t}removeHandler(e){delete this.callMap[e]}dispatch(e,t){if(!this.callMap[e])throw new Error(`方法 ${e} 未找到`);return this.callMap[e](...t)}destroy(){this.callMap={}}}!function(e){e[e.lastCall=0]="lastCall"}(Zt||(Zt={}));const ln={name:q.fireDomEvent,handler:(e,...t)=>{let[n,r,s]=t;e.document.fireEvent(n,r,s)}},hn={name:q.callback,handler:(e,t,n,r=!1)=>{e.callbackManager.trigger(t,n,r)}},un={name:q.globalEvent,handler:(t,n,r)=>{if("error"===n)try{t.globalEventManager.dispatchEvent(n,r)}catch(n){e().baseLibApi.reportError(t.id,n.name,n.message,n.stack)}else t.globalEventManager.dispatchEvent(n,r)}},dn={reportKv(t,n){e().reporter.reportKv(-1,t,n)},reportRuntimeInfo(t){e().reporter.dataReporting(-1,"runtimeInfo",JSON.stringify(t))}};class pn{static start(e){this.timeMap[e]=Date.now()}static end(e){let t=this.timeMap[e];return B(t)?0:(delete this.timeMap[e],Date.now()-t)}}pn.timeMap={};var fn;q.syncCall,function(e){e.release="release",e.createElement="createElement",e.getParentNode="getParentNode",e.getChildNode="getChildNode",e.appendChild="appendChild",e.insertChild="insertChild",e.removeChild="removeChild",e.replaceChild="replaceChild",e.spliceChild="spliceChild",e.findChildPosition="findChildPosition",e.childrenLength="childrenLength",e.setId="setId",e.setClass="setClass",e.setStyle="setStyle",e.appendStyle="appendStyle",e.replaceStyle="replaceStyle",e.clearStyle="clearStyle",e.requestLayout="requestLayout",e.getWindowWidth="getWindowWidth",e.getWindowHeight="getWindowHeight",e.getBoundingClientRect="getBoundingClientRect",e.getClientLeft="getClientLeft",e.getClientTop="getClientTop",e.getClientWidth="getClientWidth",e.getClientHeight="getClientHeight",e.getOffsetLeft="getOffsetLeft",e.getOffsetTop="getOffsetTop",e.getOffsetWidth="getOffsetWidth",e.getOffsetHeight="getOffsetHeight",e.getComputedStyle="getComputedStyle",e.getScrollPosition="getScrollPosition",e.setScrollPosition="setScrollPosition",e.setAttr="setAttr",e.setText="setText",e.setRootNode="setRootNode",e.getDevicePixelRatio="getDevicePixelRatio",e.eventListenerChange="eventListenerChange",e.querySelector="querySelector",e.querySelectorAll="querySelectorAll",e.createIntersectionObserver="createIntersectionObserver",e.deleteIntersectionObserver="deleteIntersectionObserver",e.addIntersectionObserver="addIntersectionObserver",e.removeIntersectionObserver="removeIntersectionObserver",e.showModal="showModal",e.showToast="showToast",e.hideToast="hideToast",e.showActionSheet="showActionSheet",e.setTitle="setTitle",e.setTitleAlpha="setTitleAlpha",e.callMethod="callMethod"}(fn||(fn={}));const gn={release:!0,createElement:!0,appendChild:!0,insertChild:!0,removeChild:!0,replaceChild:!0,spliceChild:!0,setId:!0,setClass:!0,setStyle:!0,setAttr:!0,setText:!0,eventListenerChange:!0};var mn;function bn(e,t,n){const r=e.apiCenter.callApi(t,n);return"string"==typeof r?JSON.parse(r):r}function vn(e){let t=[],n={};for(const s in fn)n[s]="callMethod"===s?(t,n,r,s)=>bn(e,te.domMethod,{method:n,nodeId:t,methodInfo:r,args:s}):"requestLayout"===s?(...t)=>(r(),bn(e,te.dom,{method:s,args:t})):!0===gn[s]?(...e)=>{t.push({method:mn[s],args:e})}:(...t)=>bn(e,te.dom,{method:s,args:t});function r(){t.length&&bn(e,te.dom,{method:"batchCall",args:[JSON.stringify(t)]}),t.length=0}return n.batch=r,n.version="0.0.0",n}!function(e){e[e.release=0]="release",e[e.createElement=1]="createElement",e[e.appendChild=2]="appendChild",e[e.insertChild=3]="insertChild",e[e.removeChild=4]="removeChild",e[e.replaceChild=5]="replaceChild",e[e.spliceChild=6]="spliceChild",e[e.setId=7]="setId",e[e.setClass=8]="setClass",e[e.setStyle=9]="setStyle",e[e.setAttr=10]="setAttr",e[e.setText=11]="setText",e[e.eventListenerChange=12]="eventListenerChange"}(mn||(mn={}));class yn{constructor(e){this.instance=e}showModal(e){this.instance.requireModule("dom").showModal(JSON.stringify(e),e.success||-1,e.fail||-1,e.complete||-1)}showActionSheet(e){this.instance.requireModule("dom").showActionSheet(JSON.stringify(e),e.success||-1,e.fail||-1,e.complete||-1)}showToast(e){this.instance.requireModule("dom").showToast(JSON.stringify(e),e.success||-1,e.fail||-1,e.complete||-1)}hideToast(e){this.instance.requireModule("dom").hideToast(e.success||-1,e.fail||-1,e.complete||-1)}}function Cn(e){return new yn(e)}function Sn(e,t,n,r){return new(n||(n=Promise))((function(s,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))}function Mn(e,t,n,r,s){r&&(U(s)&&U(r)?function(e,t,n){for(let r=0;r<n.length;r++){Mn(e,t,r,t[r],n[r])}t.length>n.length&&t.splice(n.length)}(e,r,s):V(s)&&V(r)&&function(e,t,n){let r=Object.keys(t).filter((e=>!n.hasOwnProperty(e)));Object.keys(n).forEach((r=>{let s=n[r],i=t[r];Mn(e,t,r,i,s)})),r.forEach((e=>{delete t[e]}))}(e,r,s)),U(t)?e.Vue.set(t,n,s):t[n]=s}var wn=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},In="object"==typeof k&&k&&k.Object===Object&&k,xn="object"==typeof self&&self&&self.Object===Object&&self,En=In||xn||Function("return this")(),_n=function(){return En.Date.now()},jn=/\s/;var An=function(e){for(var t=e.length;t--&&jn.test(e.charAt(t)););return t},On=/^\s+/;var Pn=function(e){return e?e.slice(0,An(e)+1).replace(On,""):e},Nn=En.Symbol,Tn=Object.prototype,Dn=Tn.hasOwnProperty,Ln=Tn.toString,kn=Nn?Nn.toStringTag:void 0;var Rn=function(e){var t=Dn.call(e,kn),n=e[kn];try{e[kn]=void 0;var r=!0}catch(e){}var s=Ln.call(e);return r&&(t?e[kn]=n:delete e[kn]),s},$n=Object.prototype.toString;var qn=function(e){return $n.call(e)},Bn=Nn?Nn.toStringTag:void 0;var Vn=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Bn&&Bn in Object(e)?Rn(e):qn(e)};var Hn=function(e){return null!=e&&"object"==typeof e};var Un=function(e){return"symbol"==typeof e||Hn(e)&&"[object Symbol]"==Vn(e)},Fn=/^[-+]0x[0-9a-f]+$/i,Wn=/^0b[01]+$/i,Kn=/^0o[0-7]+$/i,zn=parseInt;var Jn=function(e){if("number"==typeof e)return e;if(Un(e))return NaN;if(wn(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=wn(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Pn(e);var n=Wn.test(e);return n||Kn.test(e)?zn(e.slice(2),n?2:8):Fn.test(e)?NaN:+e},Gn=Math.max,Xn=Math.min;var Qn=function(e,t,n){var r,s,i,o,a,c,l=0,h=!1,u=!1,d=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var n=r,i=s;return r=s=void 0,l=t,o=e.apply(i,n)}function f(e){return l=e,a=setTimeout(m,t),h?p(e):o}function g(e){var n=e-c;return void 0===c||n>=t||n<0||u&&e-l>=i}function m(){var e=_n();if(g(e))return b(e);a=setTimeout(m,function(e){var n=t-(e-c);return u?Xn(n,i-(e-l)):n}(e))}function b(e){return a=void 0,d&&r?p(e):(r=s=void 0,o)}function v(){var e=_n(),n=g(e);if(r=arguments,s=this,c=e,n){if(void 0===a)return f(c);if(u)return clearTimeout(a),a=setTimeout(m,t),p(c)}return void 0===a&&(a=setTimeout(m,t)),o}return t=Jn(t)||0,wn(n)&&(h=!!n.leading,i=(u="maxWait"in n)?Gn(Jn(n.maxWait)||0,t):i,d="trailing"in n?!!n.trailing:d),v.cancel=function(){void 0!==a&&clearTimeout(a),l=0,r=c=s=a=void 0},v.flush=function(){return void 0===a?o:b(_n())},v};var Zn=function(){this.__data__=[],this.size=0};var Yn=function(e,t){return e===t||e!=e&&t!=t};var er=function(e,t){for(var n=e.length;n--;)if(Yn(e[n][0],t))return n;return-1},tr=Array.prototype.splice;var nr=function(e){var t=this.__data__,n=er(t,e);return!(n<0)&&(n==t.length-1?t.pop():tr.call(t,n,1),--this.size,!0)};var rr=function(e){var t=this.__data__,n=er(t,e);return n<0?void 0:t[n][1]};var sr=function(e){return er(this.__data__,e)>-1};var ir=function(e,t){var n=this.__data__,r=er(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};function or(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}or.prototype.clear=Zn,or.prototype.delete=nr,or.prototype.get=rr,or.prototype.has=sr,or.prototype.set=ir;var ar=or;var cr=function(){this.__data__=new ar,this.size=0};var lr=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};var hr=function(e){return this.__data__.get(e)};var ur=function(e){return this.__data__.has(e)};var dr,pr=function(e){if(!wn(e))return!1;var t=Vn(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},fr=En["__core-js_shared__"],gr=(dr=/[^.]+$/.exec(fr&&fr.keys&&fr.keys.IE_PROTO||""))?"Symbol(src)_1."+dr:"";var mr=function(e){return!!gr&&gr in e},br=Function.prototype.toString;var vr=function(e){if(null!=e){try{return br.call(e)}catch(e){}try{return e+""}catch(e){}}return""},yr=/^\[object .+?Constructor\]$/,Cr=Function.prototype,Sr=Object.prototype,Mr=Cr.toString,wr=Sr.hasOwnProperty,Ir=RegExp("^"+Mr.call(wr).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var xr=function(e){return!(!wn(e)||mr(e))&&(pr(e)?Ir:yr).test(vr(e))};var Er=function(e,t){return null==e?void 0:e[t]};var _r=function(e,t){var n=Er(e,t);return xr(n)?n:void 0},jr=_r(En,"Map"),Ar=_r(Object,"create");var Or=function(){this.__data__=Ar?Ar(null):{},this.size=0};var Pr=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Nr=Object.prototype.hasOwnProperty;var Tr=function(e){var t=this.__data__;if(Ar){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return Nr.call(t,e)?t[e]:void 0},Dr=Object.prototype.hasOwnProperty;var Lr=function(e){var t=this.__data__;return Ar?void 0!==t[e]:Dr.call(t,e)};var kr=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Ar&&void 0===t?"__lodash_hash_undefined__":t,this};function Rr(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Rr.prototype.clear=Or,Rr.prototype.delete=Pr,Rr.prototype.get=Tr,Rr.prototype.has=Lr,Rr.prototype.set=kr;var $r=Rr;var qr=function(){this.size=0,this.__data__={hash:new $r,map:new(jr||ar),string:new $r}};var Br=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var Vr=function(e,t){var n=e.__data__;return Br(t)?n["string"==typeof t?"string":"hash"]:n.map};var Hr=function(e){var t=Vr(this,e).delete(e);return this.size-=t?1:0,t};var Ur=function(e){return Vr(this,e).get(e)};var Fr=function(e){return Vr(this,e).has(e)};var Wr=function(e,t){var n=Vr(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function Kr(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Kr.prototype.clear=qr,Kr.prototype.delete=Hr,Kr.prototype.get=Ur,Kr.prototype.has=Fr,Kr.prototype.set=Wr;var zr=Kr;var Jr=function(e,t){var n=this.__data__;if(n instanceof ar){var r=n.__data__;if(!jr||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new zr(r)}return n.set(e,t),this.size=n.size,this};function Gr(e){var t=this.__data__=new ar(e);this.size=t.size}Gr.prototype.clear=cr,Gr.prototype.delete=lr,Gr.prototype.get=hr,Gr.prototype.has=ur,Gr.prototype.set=Jr;var Xr=Gr;var Qr=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e},Zr=function(){try{var e=_r(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();var Yr=function(e,t,n){"__proto__"==t&&Zr?Zr(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},es=Object.prototype.hasOwnProperty;var ts=function(e,t,n){var r=e[t];es.call(e,t)&&Yn(r,n)&&(void 0!==n||t in e)||Yr(e,t,n)};var ns=function(e,t,n,r){var s=!n;n||(n={});for(var i=-1,o=t.length;++i<o;){var a=t[i],c=r?r(n[a],e[a],a,n,e):void 0;void 0===c&&(c=e[a]),s?Yr(n,a,c):ts(n,a,c)}return n};var rs=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r};var ss=function(e){return Hn(e)&&"[object Arguments]"==Vn(e)},is=Object.prototype,os=is.hasOwnProperty,as=is.propertyIsEnumerable,cs=ss(function(){return arguments}())?ss:function(e){return Hn(e)&&os.call(e,"callee")&&!as.call(e,"callee")},ls=Array.isArray;var hs=function(){return!1},us=R((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,s=r&&r.exports===n?En.Buffer:void 0,i=(s?s.isBuffer:void 0)||hs;e.exports=i})),ds=/^(?:0|[1-9]\d*)$/;var ps=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&ds.test(e))&&e>-1&&e%1==0&&e<t};var fs=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},gs={};gs["[object Float32Array]"]=gs["[object Float64Array]"]=gs["[object Int8Array]"]=gs["[object Int16Array]"]=gs["[object Int32Array]"]=gs["[object Uint8Array]"]=gs["[object Uint8ClampedArray]"]=gs["[object Uint16Array]"]=gs["[object Uint32Array]"]=!0,gs["[object Arguments]"]=gs["[object Array]"]=gs["[object ArrayBuffer]"]=gs["[object Boolean]"]=gs["[object DataView]"]=gs["[object Date]"]=gs["[object Error]"]=gs["[object Function]"]=gs["[object Map]"]=gs["[object Number]"]=gs["[object Object]"]=gs["[object RegExp]"]=gs["[object Set]"]=gs["[object String]"]=gs["[object WeakMap]"]=!1;var ms=function(e){return Hn(e)&&fs(e.length)&&!!gs[Vn(e)]};var bs=function(e){return function(t){return e(t)}},vs=R((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,s=r&&r.exports===n&&In.process,i=function(){try{var e=r&&r.require&&r.require("util").types;return e||s&&s.binding&&s.binding("util")}catch(e){}}();e.exports=i})),ys=vs&&vs.isTypedArray,Cs=ys?bs(ys):ms,Ss=Object.prototype.hasOwnProperty;var Ms=function(e,t){var n=ls(e),r=!n&&cs(e),s=!n&&!r&&us(e),i=!n&&!r&&!s&&Cs(e),o=n||r||s||i,a=o?rs(e.length,String):[],c=a.length;for(var l in e)!t&&!Ss.call(e,l)||o&&("length"==l||s&&("offset"==l||"parent"==l)||i&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||ps(l,c))||a.push(l);return a},ws=Object.prototype;var Is=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||ws)};var xs=function(e,t){return function(n){return e(t(n))}},Es=xs(Object.keys,Object),_s=Object.prototype.hasOwnProperty;var js=function(e){if(!Is(e))return Es(e);var t=[];for(var n in Object(e))_s.call(e,n)&&"constructor"!=n&&t.push(n);return t};var As=function(e){return null!=e&&fs(e.length)&&!pr(e)};var Os=function(e){return As(e)?Ms(e):js(e)};var Ps=function(e,t){return e&&ns(t,Os(t),e)};var Ns=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t},Ts=Object.prototype.hasOwnProperty;var Ds=function(e){if(!wn(e))return Ns(e);var t=Is(e),n=[];for(var r in e)("constructor"!=r||!t&&Ts.call(e,r))&&n.push(r);return n};var Ls=function(e){return As(e)?Ms(e,!0):Ds(e)};var ks=function(e,t){return e&&ns(t,Ls(t),e)},Rs=R((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,s=r&&r.exports===n?En.Buffer:void 0,i=s?s.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,r=i?i(n):new e.constructor(n);return e.copy(r),r}}));var $s=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t};var qs=function(e,t){for(var n=-1,r=null==e?0:e.length,s=0,i=[];++n<r;){var o=e[n];t(o,n,e)&&(i[s++]=o)}return i};var Bs=function(){return[]},Vs=Object.prototype.propertyIsEnumerable,Hs=Object.getOwnPropertySymbols,Us=Hs?function(e){return null==e?[]:(e=Object(e),qs(Hs(e),(function(t){return Vs.call(e,t)})))}:Bs;var Fs=function(e,t){return ns(e,Us(e),t)};var Ws=function(e,t){for(var n=-1,r=t.length,s=e.length;++n<r;)e[s+n]=t[n];return e},Ks=xs(Object.getPrototypeOf,Object),zs=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Ws(t,Us(e)),e=Ks(e);return t}:Bs;var Js=function(e,t){return ns(e,zs(e),t)};var Gs=function(e,t,n){var r=t(e);return ls(e)?r:Ws(r,n(e))};var Xs=function(e){return Gs(e,Os,Us)};var Qs=function(e){return Gs(e,Ls,zs)},Zs=_r(En,"DataView"),Ys=_r(En,"Promise"),ei=_r(En,"Set"),ti=_r(En,"WeakMap"),ni="[object Map]",ri="[object Promise]",si="[object Set]",ii="[object WeakMap]",oi="[object DataView]",ai=vr(Zs),ci=vr(jr),li=vr(Ys),hi=vr(ei),ui=vr(ti),di=Vn;(Zs&&di(new Zs(new ArrayBuffer(1)))!=oi||jr&&di(new jr)!=ni||Ys&&di(Ys.resolve())!=ri||ei&&di(new ei)!=si||ti&&di(new ti)!=ii)&&(di=function(e){var t=Vn(e),n="[object Object]"==t?e.constructor:void 0,r=n?vr(n):"";if(r)switch(r){case ai:return oi;case ci:return ni;case li:return ri;case hi:return si;case ui:return ii}return t});var pi=di,fi=Object.prototype.hasOwnProperty;var gi=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&fi.call(e,"index")&&(n.index=e.index,n.input=e.input),n},mi=En.Uint8Array;var bi=function(e){var t=new e.constructor(e.byteLength);return new mi(t).set(new mi(e)),t};var vi=function(e,t){var n=t?bi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)},yi=/\w*$/;var Ci=function(e){var t=new e.constructor(e.source,yi.exec(e));return t.lastIndex=e.lastIndex,t},Si=Nn?Nn.prototype:void 0,Mi=Si?Si.valueOf:void 0;var wi=function(e){return Mi?Object(Mi.call(e)):{}};var Ii=function(e,t){var n=t?bi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)};var xi=function(e,t,n){var r=e.constructor;switch(t){case"[object ArrayBuffer]":return bi(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return vi(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Ii(e,n);case"[object Map]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return Ci(e);case"[object Set]":return new r;case"[object Symbol]":return wi(e)}},Ei=Object.create,_i=function(){function e(){}return function(t){if(!wn(t))return{};if(Ei)return Ei(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();var ji=function(e){return"function"!=typeof e.constructor||Is(e)?{}:_i(Ks(e))};var Ai=function(e){return Hn(e)&&"[object Map]"==pi(e)},Oi=vs&&vs.isMap,Pi=Oi?bs(Oi):Ai;var Ni=function(e){return Hn(e)&&"[object Set]"==pi(e)},Ti=vs&&vs.isSet,Di=Ti?bs(Ti):Ni,Li="[object Arguments]",ki="[object Function]",Ri="[object Object]",$i={};$i[Li]=$i["[object Array]"]=$i["[object ArrayBuffer]"]=$i["[object DataView]"]=$i["[object Boolean]"]=$i["[object Date]"]=$i["[object Float32Array]"]=$i["[object Float64Array]"]=$i["[object Int8Array]"]=$i["[object Int16Array]"]=$i["[object Int32Array]"]=$i["[object Map]"]=$i["[object Number]"]=$i[Ri]=$i["[object RegExp]"]=$i["[object Set]"]=$i["[object String]"]=$i["[object Symbol]"]=$i["[object Uint8Array]"]=$i["[object Uint8ClampedArray]"]=$i["[object Uint16Array]"]=$i["[object Uint32Array]"]=!0,$i["[object Error]"]=$i[ki]=$i["[object WeakMap]"]=!1;var qi=function e(t,n,r,s,i,o){var a,c=1&n,l=2&n,h=4&n;if(r&&(a=i?r(t,s,i,o):r(t)),void 0!==a)return a;if(!wn(t))return t;var u=ls(t);if(u){if(a=gi(t),!c)return $s(t,a)}else{var d=pi(t),p=d==ki||"[object GeneratorFunction]"==d;if(us(t))return Rs(t,c);if(d==Ri||d==Li||p&&!i){if(a=l||p?{}:ji(t),!c)return l?Js(t,ks(a,t)):Fs(t,Ps(a,t))}else{if(!$i[d])return i?t:{};a=xi(t,d,c)}}o||(o=new Xr);var f=o.get(t);if(f)return f;o.set(t,a),Di(t)?t.forEach((function(s){a.add(e(s,n,r,s,t,o))})):Pi(t)&&t.forEach((function(s,i){a.set(i,e(s,n,r,i,t,o))}));var g=u?void 0:(h?l?Qs:Xs:l?Ls:Os)(t);return Qr(g||t,(function(s,i){g&&(s=t[i=s]),ts(a,i,e(s,n,r,i,t,o))})),a};var Bi,Vi=function(e){return qi(e,5)};!function(e){e[e.wait=0]="wait",e[e.pass=1]="pass"}(Bi||(Bi={}));class Hi{constructor(e){this.instance=e,this.state=Bi.wait,this.taskBuffer=[],this.params=void 0}flush(e){this.params=e,this.state=Bi.pass;let t=this.taskBuffer.shift();for(;t;)t(this.params),t=this.taskBuffer.shift()}run(e){this.state===Bi.pass?e(this.params):this.taskBuffer.push(e)}}class Ui extends Hi{constructor(e){super(e);let t=e=>{this.flush(e),this.instance.globalEventManager.removeEventListener(de.routeEnter,t)};this.instance.globalEventManager.addEventListener(de.routeEnter,t,!0)}}const Fi="lite/pageInit",Wi={pageInitAction:""};function Ki(e,t,n){let r,s,i;return F(e)?(s=t,r=e,i=n):(r="",s=e,i=t),{namespace:r,config:s,option:i}}function zi(...e){return e.filter((e=>!!e)).join("/")}function Ji(e,t,n){const r=e.call(t,n);return F(r)?{pointer:r}:r}function Gi(e){let t=[],n=[];return U(e)?e.forEach((e=>{t.push({pointer:e,computedKey:e})})):H(e)&&Object.keys(e).map((r=>{const s=e[r];W(s)?n.push({builder:s,computedKey:r}):F(s)?t.push({pointer:s,computedKey:r}):t.push(Object.assign(Object.assign({},s),{computedKey:r}))})),{builderItems:n,staticItems:t}}function Xi(e,t){return U(e)?e.map((e=>({key:e,val:zi(t,e)}))):H(e)?Object.keys(e).map((n=>({key:n,val:zi(t,e[n])}))):[]}class Qi{constructor(e){this.flushSubscribeDebounce=Qn(this.flushSubscribe,1,{}),this.subscribeBuffer=[],this.storeConfig=Vi(Wi),this.defaultDataCache={},this.instance=e,this.connectModule=e.requireModule("connect"),this.routerModule=e.requireModule("router"),this.useSyncCall=e.instanceConfig.syncCall,this.state=e.runtimeContext.Vue.reactive({}),this.reactiveKeys=e.runtimeContext.Vue.reactive({}),this.setDataProcessController=new Hi(this.instance),this.initConnection()}get storeShadow(){return this.state}destroy(){this.flushSubscribeDebounce.cancel()}config(e){e.pageInitAction&&(F(e.pageInitAction)?this.storeConfig.pageInitAction=e.pageInitAction:this.storeConfig.pageInitAction=Fi,this.instance.routeEnterProcessController.run((()=>Sn(this,void 0,void 0,(function*(){yield new this.instance.injectContext.Promise((e=>{this.instance.injectContext.setTimeout(e,1)}));let e=null;try{e=yield this.dispatch(this.storeConfig.pageInitAction,{query:this.routerModule.currentQuery,route:this.routerModule.currentRoute})}catch(e){}this.setDataProcessController.flush(),this.instance.globalEventManager.dispatchEvent("store.pageInit",[null,e],{backtracking:!0})})))))}init(e){let t=[];Object.keys(e).forEach((n=>{t.push({point:n,value:e[n]})})),this.updateData(t)}dispatch(e,t,n){return new this.instance.injectContext.Promise(((r,s)=>{pn.start("dispatch"),this.connectModule.dispatch(e,t||{},(e=>{"json"===e.type?r(e.result):"error"===e.type?s(new Error(e.result)):r(e.result)}),n)}))}syncGetDefaultData(e){if(this.useSyncCall)return this.defaultDataCache[e]||(this.defaultDataCache[e]={value:this.connectModule.syncCall({type:"getData",target:e})}),this.defaultDataCache[e].value}releaseDefaultData(e){this.useSyncCall&&delete this.defaultDataCache[e]}connectViews(e,t,n){const r=Ki(e,t,n);if(!r.config)return{};let s={};const i=Gi(r.config),o=this;for(const e of i.staticItems){let t=zi(r.namespace,e.pointer);this.state[t]="",this.subscribe(t),s[e.computedKey]=()=>this.state[t]}for(const e of i.builderItems){const t=ue(this.routerEnter.bind(this));s[e.computedKey]=function(){const n=o.resolveFinalPointer(r.namespace,e,this,!0);return o.updateReactiveKey(e.computedKey,n.finalPointer),t(this,r.namespace,e),o.state[o.reactiveKeys[e.computedKey]]}}return s}connectActions(e,t,n){const r=Ki(e,t,n);if(!r.config)return{};let s={};return Xi(r.config,r.namespace).forEach((({key:e,val:t})=>{s[e]=e=>this.dispatch(t,e,r.option)})),s}updateReactiveKey(e,t){let n=this.reactiveKeys[e];n!==t&&(n&&this.unsubscribe(n),this.subscribe(t),this.reactiveKeys[e]=t,this.state[t]="")}subscribe(e){this.subscribeBuffer.push(e),this.flushSubscribeDebounce()}unsubscribe(e){this.connectModule.unsubscribe([e]),this.releaseDefaultData(e)}routerEnter(e,t,n){this.instance.routeEnterProcessController.run((r=>{const s=this.resolveFinalPointer(t,n,e);this.updateReactiveKey(n.computedKey,s.finalPointer)}))}resolveFinalPointer(e,t,n,r=!1){let s=t.pointer;if(t.builder){let e=Ji(t.builder,n,r);Object.assign(t,e),s=e.pointer}if(!s)throw new Error("final pointer undefined");return t.params&&(s=`${s}?${he.stringify(t.params)}`),s=zi(e,s),t.finalPointer=s,t}flushSubscribe(){this.connectModule.subscribe(this.subscribeBuffer),this.subscribeBuffer.length=0}updateData(e){for(const t of e)this.state.hasOwnProperty(t.point)&&Mn({Vue:{set(e,t,n){e[t]=n}}},this.state,t.point,this.state[t.point],t.value)}initConnection(){this.instance.globalEventManager.addEventListener(fe.data,(e=>Sn(this,void 0,void 0,(function*(){const t=e.changes;t&&(this.storeConfig.pageInitAction?this.setDataProcessController.run((()=>{this.updateData(t)})):this.updateData(t))}))))}}class Zi{constructor(e){this._pointerId=1,this.initStoreShadow={},this.relationRecord={},this.flushSubscribeDebounce=Qn(this.flushSubscribe,1,{}),this.subscribeBuffer=[],this.storeConfig=Vi(Wi),this.defaultDataCache={},this.instance=e,this.connectModule=e.requireModule("connect"),this.routerModule=e.requireModule("router"),this.useSyncCall=e.instanceConfig.syncCall,this.vueInstance=new e.runtimeContext.Vue({data:{$$state:{},$$pointerMap:{}}}),this.setDataProcessController=new Hi(this.instance),this.storeShadow=this.vueInstance.$data.$$state,this.initConnection()}get pointerId(){return(this._pointerId++).toString()}destroy(){this.flushSubscribeDebounce.cancel()}config(e){e.pageInitAction&&(F(e.pageInitAction)?this.storeConfig.pageInitAction=e.pageInitAction:this.storeConfig.pageInitAction=Fi,this.instance.routeEnterProcessController.run((()=>Sn(this,void 0,void 0,(function*(){yield new this.instance.injectContext.Promise((e=>{this.instance.injectContext.setTimeout(e,1)}));let e=null;try{e=yield this.dispatch(this.storeConfig.pageInitAction,{query:this.routerModule.currentQuery,route:this.routerModule.currentRoute})}catch(e){}this.setDataProcessController.flush(),this.instance.globalEventManager.dispatchEvent("store.pageInit",[null,e],{backtracking:!0})})))))}init(e){Object.assign(this.initStoreShadow,e)}dispatch(e,t,n){return new this.instance.injectContext.Promise(((r,s)=>{pn.start("dispatch"),this.connectModule.dispatch(e,t||{},(e=>{"json"===e.type?r(e.result):"error"===e.type?s(new Error(e.result)):r(e.result)}),n)}))}syncGetDefaultData(e){if(this.useSyncCall)return this.defaultDataCache[e]||(this.defaultDataCache[e]={value:this.connectModule.syncCall({type:"getData",target:e})}),this.defaultDataCache[e].value}releaseDefaultData(e){this.useSyncCall&&delete this.defaultDataCache[e]}connectViews(e,t,n){const r=Ki(e,t,n);if(!r.config)return{};let s={};const i=Gi(r.config),o=this,a={};for(const e of i.staticItems){const t=this.pointerId;let n=zi(r.namespace,e.pointer);s[e.computedKey]=()=>(a[t]||(o.buildStoreRelation(n,e),a[t]=!0),o.storeShadow[n])}for(const e of i.builderItems){const t=this.pointerId;o.vueInstance.$set(o.vueInstance.$data.$$pointerMap,t,void 0),s[e.computedKey]=function(){let n=o.vueInstance.$data.$$pointerMap[t];if(n){const s=o.resolveFinalPointer(r.namespace,e,this).finalPointer;return s!==n?(o.buildStoreRelation(s,e),o.vueInstance.$data.$$pointerMap[t]=s,o.releaseStoreRelation(n),o.storeShadow[s]):o.storeShadow[n]}if(o.instance.routeEnterProcessController.run((()=>{const s=o.resolveFinalPointer(r.namespace,e,this);n=s.finalPointer,o.buildStoreRelation(n,e),o.vueInstance.$data.$$pointerMap[t]=n})),n)return o.storeShadow[n];{const t=o.resolveFinalPointer(r.namespace,e,this,!0);return o.buildStoreRelation(t.finalPointer,e),o.storeShadow[t.finalPointer]}}}return s}connectActions(e,t,n){const r=Ki(e,t,n);if(!r.config)return{};let s={};return Xi(r.config,r.namespace).forEach((({key:e,val:t})=>{s[e]=e=>this.dispatch(t,e,r.option)})),s}flushSubscribe(){this.connectModule.subscribe(this.subscribeBuffer),this.subscribeBuffer.length=0}buildStoreRelation(e,t){if(B(this.relationRecord[e])||this.relationRecord[e]<=0){let n=this.initStoreShadow[e];n||(n=B(t.defaultValue)?this.syncGetDefaultData(e):t.defaultValue),this.vueInstance.$set(this.storeShadow,e,n),this.subscribeBuffer.push(e),this.relationRecord[e]=1,this.flushSubscribeDebounce()}else this.relationRecord[e]++}releaseStoreRelation(e){this.relationRecord[e]--,this.relationRecord[e]<=0&&(delete this.storeShadow[e],this.connectModule.unsubscribe([e]),delete this.relationRecord[e],this.releaseDefaultData(e))}resolveFinalPointer(e,t,n,r=!1){let s=t.pointer;if(t.builder){let e=Ji(t.builder,n,r);Object.assign(t,e),s=e.pointer}if(!s)throw new Error("final pointer undefined");return t.params&&(s=`${s}?${he.stringify(t.params)}`),s=zi(e,s),t.finalPointer=s,t}updateData(e){for(const t of e)this.relationRecord[t.point]&&Mn(this.instance.runtimeContext,this.storeShadow,t.point,this.storeShadow[t.point],t.value)}initConnection(){this.instance.globalEventManager.addEventListener(fe.data,(e=>Sn(this,void 0,void 0,(function*(){const t=e.changes;t&&(this.storeConfig.pageInitAction?this.setDataProcessController.run((()=>{this.updateData(t)})):this.updateData(t))}))))}}function Yi(e){return e.config.frameworkType===$.Vue3ForFlutterPage?new Qi(e):new Zi(e)}class eo{constructor(e){this.snapshotManager=e.snapshotManager}get snapshotMode(){return this.snapshotManager.snapshotMode}save(){this.snapshotManager.save()}remove(){this.snapshotManager.remove()}cancelAutoSave(){this.snapshotManager.cancelAutoSave()}}function to(e){return new eo(e)}class no extends class{constructor(e={}){this.moduleSnapshotConfig=e,this.requireNumber=0,this.register=ne.getInstance(),this.localModuleBuilders={}}get moduleNames(){return Object.keys(this.localModuleBuilders).concat(this.register.publicModuleNames)}add(e,t){this.localModuleBuilders[e]=t}requireModule(e,t){if(this.localModuleBuilders[t])return this.requireNumber++,this.bindLocalModules(e,this.localModuleBuilders[t]);const n=this.register.modulesInfo[t];return n&&!n.private?(this.requireNumber++,this.bindRegisterModules(e,t,this.register.modulesInfo[t])):void 0}bingRegisterModuleMethods(e,t,n,r){const s=r.methods;for(const i of s)this.bingRegisterModuleMethod(e,t,n,i,r)}bingRegisterModuleAccessorProps(e,t,n){const r=n.accessorProps;if(r)for(const s of r){let r=s.name[0].toUpperCase()+s.name.slice(1),i=`get${r}`,o=s.setter?`set${r}`:"";Object.defineProperty(t,s.name,{enumerable:!0,configurable:!0,get:()=>e.apiCenter.callApi(te.global,{globalKey:n.bridge.name,methodInfo:{name:i,result:s.getter.result,params:[]},method:i,args:[]}),set:o?t=>e.apiCenter.callApi(te.global,{globalKey:n.bridge.name,methodInfo:{name:o,params:s.setter&&[s.setter.param]},method:o,args:[t]}):void 0})}}bindRegisterModules(e,t,n){const r={},s=n.bridge,i=this.moduleSnapshotConfig[t],o="global"===s.type?te.global:te.dynamic;i&&(r.__lite__={snapshotConfig:i,snapshotCallLastCallMap:{},replay:t=>{for(let r of t){let t=n.methods.find((e=>e.name===r.method));t?e.apiCenter.callApi(o,{globalKey:s.name,methodInfo:t,method:t.name,args:r.args}):J.error("[view] replay module record with method not exist")}}}),this.bingRegisterModuleMethods(e,r,t,n),this.bingRegisterModuleAccessorProps(e,r,n);const a=n.props;return Object.assign(r,a),r}bindLocalModules(e,t){return t(e)}requirePrivateModule(e,t){if(this.register.modulesInfo[t])return this.bindRegisterModules(e,t,this.register.modulesInfo[t])}bingRegisterModuleMethod(e,t,n,r,s){let i;if("global"===s.bridge.type)if(t.__lite__&&t.__lite__.snapshotConfig[r.name]&&t.__lite__.snapshotConfig[r.name].type===Zt.lastCall){const n=t.__lite__.snapshotCallLastCallMap;i=(...t)=>(n[r.name]={method:r.name,args:t},e.apiCenter.callApi(te.global,{globalKey:s.bridge.name,methodInfo:r,method:r.name,args:t}))}else i=(...t)=>e.apiCenter.callApi(te.global,{globalKey:s.bridge.name,methodInfo:r,method:r.name,args:t});else i=(...t)=>e.apiCenter.callApi(te.dynamic,{moduleName:n,methodInfo:r,method:r.name,args:t});Object.defineProperty(t,r.name,{enumerable:!1,configurable:!1,get:()=>i})}}{static getInstance(){return no.instance||(no.instance=new no({controls:{setTitle:{type:Zt.lastCall},setTitleAlpha:{type:Zt.lastCall},setTitleBackgroundColor:{type:Zt.lastCall},setBottomBarColor:{type:Zt.lastCall},showTitle:{type:Zt.lastCall},hideTitle:{type:Zt.lastCall},setHomeIcon:{type:Zt.lastCall},setTitleIcon:{type:Zt.lastCall},setSubtitle:{type:Zt.lastCall},setSubtitleColor:{type:Zt.lastCall},setTitleLeftText:{type:Zt.lastCall},setTitleRightText:{type:Zt.lastCall},setTitleTextButtonColor:{type:Zt.lastCall}}})),no.instance.add("dom",vn),no.instance.add("store",Yi),no.instance.add("notice",Cn),no.instance.add("snapshot",to),no.instance}}class ro{constructor(e){this.list=[],this.isDirty=!0,this.className="",this.onChange=e}get value(){return this.toClassName()}get length(){return this.list.length}add(...e){for(const t of e)this.list.indexOf(t)<=-1&&this.list.push(t);return this.triggerChange(),this.list}contains(e){return this.list.indexOf(e)>=0}setClassList(e){this.list=e,this.triggerChange()}item(e){return this.list[e]}remove(...e){return this.list=this.list.filter((t=>e.indexOf(t)<=-1)),this.triggerChange(),this.list}toClassName(){return this.isDirty&&(this.className=this.list.join(" "),this.isDirty=!1),this.className}fromClassName(e){this.list=e.split(" "),this.triggerChange()}toggle(e,t){const n=this.list.indexOf(e),r=n>=0;return void 0===t?(r?this.list.splice(n,1):this.list.push(e),this.triggerChange(),!r):(t!==r&&(t?this.list.push(e):this.list.splice(n,1)),this.triggerChange(),t)}triggerChange(){const e=this.list.join(" ");this.className!==e&&(this.isDirty=!1,this.className=e,this.onChange(e))}}let so=["scroll","load","focus","confirm","blur","timeupdate","scrolltoupper","scrolltolower","change"];class io{constructor(e,t){this.cancelBubble=!1,this.isStopImmediatePropagation=!1,this.currentTarget=null,this.defaultPrevented=!1,this.target=null,this.timeStamp=0,this.eventPhase=oo.NONE,this.type=e,this.bubbles=t.bubbles,this.cancelable=t.cancelable}stopImmediatePropagation(){this.isStopImmediatePropagation=!0,this.cancelBubble=!0}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.cancelBubble=!0}}var oo,ao,co;function lo(e){return"decisionViewMapping"in e}!function(e){e[e.NONE=0]="NONE",e[e.CAPTURING_PHASE=1]="CAPTURING_PHASE",e[e.AT_TARGET=2]="AT_TARGET",e[e.BUBBLING_PHASE=3]="BUBBLING_PHASE"}(oo||(oo={})),function(e){e.touchstart="touchstart",e.touchmove="touchmove",e.touchcancel="touchcancel",e.touchend="touchend",e.tap="tap",e.longpress="longpress",e.longtap="longtap",e.transitionend="transitionend",e.touchforcechange="touchforcechange",e.updateProps="lite.updateProps"}(ao||(ao={})),function(e){e[e.element=1]="element",e[e.text=3]="text",e[e.comment=8]="comment"}(co||(co={}));class ho extends class{constructor(e,t){this.childNodes=[],this.parentNode=null,this.mutationObserveParentNode=null,this.nextSibling=null,this.previousSibling=null,this.hasViewMapping=!1,this.destroyed=!1,this.nodeId=t.nodeId,this.nodeType=e,this.ownerDocument=t.ownerDocument,this.domModule=this.ownerDocument.instance.requireModule("dom"),this.ref=t.ref||t.nodeId,this.hasViewMapping=t.hasViewMapping}get textContent(){let e="";return e+=this.childNodes.map((e=>e.textContent)).join(""),e}set textContent(e){this.removeAllChild(),this.appendChild(this.ownerDocument.createTextNode(e))}get firstChild(){return this.childNodes[0]||null}hasChildNodes(){return!!this.childNodes.length}appendChild(e){this.couldHasChildNodes()&&(this.transferRelationship(e,this),this.insertIndex(e,this.childNodes,this.childNodes.length),lo(e)&&e.decisionViewMapping(this),e.hasViewMapping&&this.domModule.appendChild(this.nodeId,e.nodeId))}insertBefore(e,t){if(!this.couldHasChildNodes())return;if(e===t||e.nextSibling&&e.nextSibling===t)return;let n;this.transferRelationship(e,this),n=t?this.findIndex(t,this.childNodes):this.findLastIndex(this.childNodes),this.insertIndex(e,this.childNodes,n?n.nodeIndex:0),lo(e)&&e.decisionViewMapping(this),e.hasViewMapping&&this.domModule.insertChild(this.nodeId,e.nodeId,(null==n?void 0:n.elementIndex)||0)}insertAfter(e,t){if(!this.couldHasChildNodes())return;if(e===t||e.previousSibling&&e.previousSibling===t)return;this.transferRelationship(e,this);const n=this.findIndex(t,this.childNodes);this.insertIndex(e,this.childNodes,n?n.nodeIndex+1:0),lo(e)&&e.decisionViewMapping(this),e.hasViewMapping&&this.domModule.insertChild(this.nodeId,e.nodeId,(null==n?void 0:n.elementIndex)||0)}removeChild(e){let t=this.removeChildNode(e,this.childNodes);t&&e.hasViewMapping&&this.domModule.removeChild(this.nodeId,t.elementIndex)}removeAllChild(e=!1){let t=[];for(const n of this.childNodes)t.push(n),n.hasViewMapping&&this.domModule.removeChild(this.nodeId,0),e&&n.destroy(!1,!1);this.ownerDocument.mutationObserverManager.notifyChildList(this,{addedNodes:[],removedNodes:t,previousSibling:null,nextSibling:null}),this.childNodes=[]}destroy(e=!1,t=!0){if(!this.destroyed){this.hasViewMapping&&!e&&this.domModule.release(this.nodeId),this.parentNode&&t&&this.parentNode.vdomRemoveChild(this);for(let e=this.childNodes[0];e;e=this.childNodes[0])e.destroy(!0);this.destroyed=!0,delete this.ownerDocument.nodeMap[this.nodeId]}}toDebugXML(){return`[node ${this.nodeId}]`}findLastIndex(e){let t=0,n=0;for(const r of e)r.hasViewMapping&&n++,t++;return{nodeIndex:t,elementIndex:n}}vdomRemoveChild(e){return this.removeChildNode(e,this.childNodes)}findIndex(e,t){let n=0,r=0;for(const s of t){if(s===e)return{nodeIndex:n,elementIndex:r};s.hasViewMapping&&r++,n++}return null}removeChildNode(e,t){const n=this.findIndex(e,t);if(!n)return n;const r=n.nodeIndex,s=t[r-1],i=t[r+1];return s&&(s.nextSibling=i),i&&(i.previousSibling=s),e.nextSibling=null,e.previousSibling=null,t.splice(r,1),this.ownerDocument.mutationObserverManager.notifyChildList(this,{addedNodes:[],removedNodes:[e],previousSibling:s,nextSibling:i}),n}transferRelationship(e,t){e.parentNode&&e.parentNode.vdomRemoveChild(e),t?e.parentNode=t:delete e.parentNode}couldHasChildNodes(){return this.nodeType===co.element}insertIndex(e,t,n){const r=n<0?0:n,s=t[r-1],i=t[r];return t.splice(n,0,e),s&&(s.nextSibling=e),i&&(i.previousSibling=e),e.previousSibling=s,e.nextSibling=i,this.ownerDocument.mutationObserverManager.notifyChildList(this,{addedNodes:[e],removedNodes:[],previousSibling:s,nextSibling:i}),r}}{remove(){this.parentNode?this.parentNode.removeChild(this):this.destroy()}}const uo={nextElementSibling(e){let t=e.nextSibling;for(;t;){if(t.nodeType===co.element)return t;t=t.nextSibling}return null},previousElementSibling(e){let t=e.previousSibling;for(;t;){if(t.nodeType===co.element)return t;t=t.previousSibling}return null}};class po extends ho{constructor(){super(...arguments),this._data=""}get data(){return this._data}set data(e){this._data=e}get length(){return this.data.length}get nextElementSibling(){return uo.nextElementSibling(this)}get previousElementSibling(){return uo.previousElementSibling(this)}appendData(e){this.data+=e}deleteData(e,t){if(B(e)||B(t))throw new Error("2 arguments required");this.data=this.data.slice(0,e)+this.data.slice(e+t)}replaceData(e,t,n=""){if(B(e)||B(t))throw new Error("2 arguments required");this.data=this.data.slice(0,e)+n+this.data.slice(e+t)}substringData(e,t){if(B(e)||B(t))throw new Error("2 arguments required");return this.data.slice(e,e+t)}insertData(e,t){if(B(e))throw new Error("2 arguments required");t&&(this.data=this.data.slice(0,e)+t+this.data.slice(e))}}class fo extends po{constructor(e,t){super(co.comment,t),this.data=e}toDebugXML(){return`\x3c!--${this.data} (node-id:${this.nodeId})--\x3e`}get textContent(){return this.data}set textContent(e){this.data=e}destroy(){super.destroy()}}function go(e){return"__cssTextDirty"!==e&&"__cssPropsDirty"!==e&&"__associatedElement"!==e&&"__dataSource"!==e}class mo{constructor(e,t){return this.__cssTextDirty=!0,this.__cssPropsDirty=!0,this.__associatedElement=e,this.__dataSource=t,new Proxy(this,{ownKeys(e){e.updateCssProps();return Reflect.ownKeys(e).filter((e=>"cssText"!==e&&go(e)))},get(e,t){e.__cssPropsDirty&&(e.updateCssProps(),e.__cssPropsDirty=!1);let n=Reflect.get(e,t);return B(n)&&(n=Reflect.get(e,ce(t.toString()))),n},set(t,n,r){if(!e)throw new Error(`${n.toString()} is read-only`);const s=B(r)?"":r.toString();if(F(n)){if("cssText"===n)t.cssText=s,e.attr.style=s,e.domModule.setStyle(e.nodeId,s);else{t[ce(n)]=s,t.__cssTextDirty=!0;const r=Reflect.get(t,"cssText");e.attr.style=r,e.domModule.setStyle(e.nodeId,r)}return!0}return!1}})}get cssText(){if(this.__associatedElement){if(this.__cssTextDirty){let e="";for(let t of Object.keys(this))go(t)&&!B(this[t])&&""!==this[t]&&(e+=`${le(t)}:${this[t]};`);this.__associatedElement.attr.style=e,this.__cssTextDirty=!1}return this.__associatedElement.attr.style}{let e="";for(let t of Object.keys(this))go(t)&&!B(this[t])&&(e+=`${le(t)}:${this[t]};`);return e}}set cssText(e){if(!this.__associatedElement)throw new Error("cssText is read-only");this.__associatedElement.attr.style=e,this.__cssPropsDirty=!0}updateCssProps(){if(this.__associatedElement&&this.__associatedElement.attr.style){this.__associatedElement.attr.style.split(";").forEach((e=>{if(!e.trim())return;let t=e.split(":");const n=t[0];let r=t[1];"cssText"!==n&&(r&&(r=r.trim()),this[ce(n)]=r)}))}else if(this.__dataSource){const e=this.__dataSource;for(const t in e)if(e.hasOwnProperty(t)){let n=e[t];n&&(n=n.trim()),this[ce(t)]=n}}}}class bo{constructor(e){return new Proxy(this,{deleteProperty:(t,n)=>(e.removeAttribute(`data-${le(n.toString())}`),!(n in t)||Reflect.deleteProperty(t,n)),ownKeys(t){const n=[],r=Object.keys(e.attr);for(const s of r)0===s.indexOf("data-")&&(Reflect.set(t,ce(s.slice(5)),e.getAttribute(s)),n.push(ce(s.slice(5))));return n},get(t,n){const r=n.toString(),s=Reflect.get(t,n);if(B(s)){const s=`data-${le(r)}`,i=e.getAttribute(s);return Reflect.set(t,n,i),i}return s},set(t,n,r){const s=`data-${le(n.toString())}`,i=r.toString();return Reflect.set(t,n,i),e.setAttribute(s,i),!0}})}}const vo="&quot;",yo='"';const Co={encode:function(e){return e.replace(/"/g,vo)},decode:function(e){return e.replace(/&quot;/g,yo)}},So=/([^<>=\s]+(=("[^"]+)")?)/g,Mo=/<([A-Za-z0-9_-]+)((\s+([^<>='"\/\s]+(="[^"]*")?))*)\s*(\/)?>|<\/([A-Za-z0-9_-]+)\s*>|<!--([^<>]*)-->|([^<>]+)/g;var wo,Io;!function(e){e[e.open=0]="open",e[e.self=1]="self",e[e.end=2]="end",e[e.text=3]="text",e[e.comment=4]="comment"}(wo||(wo={}));class xo{constructor(e,t){this.child=[],this.attrs={},this.isSelfClose=!1,this.tagName=e,t&&(t.attrStr&&this.setAttrs(t.attrStr),this.isSelfClose=!!t.isSelfClose)}static is(e){return!!e.tagName}addChild(e){this.child.push(e),e.parent=this}setAttrs(e){let t=So.exec(e);for(;t;){const n=t[0],r=n.indexOf("=");let s,i="";r>-1?(i=n.slice(0,r),s=n.slice(r+2,n.length-1)):(i=n,s=""),this.attrs[i]=Co.decode(s),t=So.exec(e)}}}class Eo{constructor(e){this.value=e}}class _o{constructor(e){this.value=e}}function jo(e){return e[1]?B(e[6])?{value:e[1],type:wo.open,attrStr:e[2]}:{value:e[1],type:wo.self,attrStr:e[2],isSelfClose:!0}:B(e[7])?B(e[8])?{value:e[9],type:wo.text}:{value:e[8],type:wo.comment}:{value:e[7],type:wo.end}}class Ao{constructor(e=0,t=0,n=0,r=0){this.x=e,this.y=t,this.width=n,this.height=r}get top(){return Math.min(this.y,this.y+this.height)}get right(){return Math.max(this.x,this.x+this.width)}get bottom(){return Math.max(this.y,this.y+this.height)}get left(){return Math.min(this.x,this.x+this.width)}static fromRect(e){return new Ao(e.x,e.y,e.width,e.height)}}!function(e){e.div="div",e.body="body",e.head="head",e.style="style",e.document="document"}(Io||(Io={}));class Oo extends ho{constructor(e=Io.div,t){super(co.element,ie(t,{hasViewMapping:!0})),this.nodeType=co.element,this.event={},this.scopedClass=[],this.isSelfClose=!1,this.tagName=e,this.attr={},this.hasViewMapping?(this.classList=new ro((e=>{this.updateClass(this.scopedClass,e)})),this.domModule.createElement(this.nodeId,e)):this.classList=new ro((()=>{})),t.attr&&this.setAttrObject(t.attr,t.isSnapshot)}get clientHeight(){return this.domModule.getClientHeight(this.nodeId)}get clientWidth(){return this.domModule.getClientWidth(this.nodeId)}get clientTop(){return this.domModule.getClientTop(this.nodeId)}get clientLeft(){return this.domModule.getClientLeft(this.nodeId)}get offsetHeight(){return this.domModule.getOffsetHeight(this.nodeId)}get offsetWidth(){return this.domModule.getOffsetWidth(this.nodeId)}get offsetTop(){return this.domModule.getOffsetTop(this.nodeId)}get offsetLeft(){return this.domModule.getOffsetLeft(this.nodeId)}get snapshotInnerHTML(){return this._getInnerHTML(!0,!0)}set snapshotInnerHTML(e){this._setInnerHTML(e,!0)}get innerHTML(){return this._getInnerHTML(!1)}set innerHTML(e){this._setInnerHTML(e,!1)}get id(){return this.getAttribute("id")}set id(e){this.setAttribute("id",e)}get children(){return this.childNodes.filter((e=>e.nodeType===co.element))}get className(){return this.classList.toClassName()}set className(e){this.classList.fromClassName(e)}get nextElementSibling(){return uo.nextElementSibling(this)}get previousElementSibling(){return uo.previousElementSibling(this)}get scrollHeight(){return this.domModule.getScrollPosition(this.nodeId).scrollHeight}get scrollWidth(){return this.domModule.getScrollPosition(this.nodeId).scrollWidth}get scrollTop(){return this.domModule.getScrollPosition(this.nodeId).scrollTop}set scrollTop(e){this.scroll({top:e})}get scrollLeft(){return this.domModule.getScrollPosition(this.nodeId).scrollLeft}set scrollLeft(e){this.scroll({left:e})}get style(){return this._style||(this._style=new mo(this)),this._style}set style(e){F(e)&&(this.style.cssText=e)}get dataset(){return this._dataset||(this._dataset=new bo(this)),this._dataset}static is(e){return e.nodeType===co.element}toJSON(){return{}}addScopedClass(e){if(!(this.scopedClass.indexOf(e)>=0)&&(this.scopedClass.push(e),this.hasViewMapping)){let e=this.classList.toClassName();this.updateClass(this.scopedClass,e)}}toDebugXML(){let e=` node-id="${this.nodeId}"`;this.id&&(e+=` id="${this.id}"`),this.className&&(e+=` class="${this.className}"`);const t=this.getDebugAttrString();t&&(e+=` ${t}`);const n=this.getDebugEventString();n&&(e+=` ${n}`),this.scopedClass.length&&(e+=" scoped");let r=`<${this.tagName}${e}>`,s=`</${this.tagName}>`;return this.childNodes.length||(r=`<${this.tagName}${e}/>`,s=""),this.childNodes.forEach((e=>{r=r+=`${e.toDebugXML()}`})),r+=s,r}querySelector(e){const t=this.domModule.querySelector(this.nodeId,e);return t>=0?this.ownerDocument.getRef(t.toString()):null}querySelectorAll(e){return this.domModule.querySelectorAll(this.nodeId,e).map((e=>this.ownerDocument.getRef(e.toString())))}getBoundingClientRect(){let e=this.domModule.getBoundingClientRect(this.nodeId);return Ao.fromRect({x:e[0],y:e[1],width:e[4],height:e[5]})}scrollTo(e,t){this.scroll(e,t)}scroll(e,t){let n,r,s=0;V(e)?(n=e.left,r=e.top,"smooth"===e.behavior&&(s=300),B(e.duration)||(s=e.duration)):(n=e,r=t),this.domModule.setScrollPosition(this.nodeId,JSON.stringify({scrollLeft:n,scrollTop:r,duration:s}))}scrollBy(e,t){let n={top:void 0,left:void 0,duration:0};V(e)?n=e:(n.left=e,n.top=t);let r=this.domModule.getScrollPosition(this.nodeId);B(n.left)||(n.left=r.scrollLeft+n.left),B(n.top)||(n.top=r.scrollTop+n.top),this.scroll(n)}addEventListener(e,t,n={once:!1}){this.pushEventListener(e,t,n)&&this.domModule.eventListenerChange(this.nodeId,!0,e)}removeEventListener(e,t){const n=this.event[e];if(!n||!n.length)return;const r=n.findIndex((e=>e.listener===t));r>=0&&n.splice(r,1),0===n.length&&this.domModule.eventListenerChange(this.nodeId,!1,e)}dispatchEvent(e){if(e.eventPhase===oo.NONE){const t=[this];let n=this.parentNode;for(;n&&n instanceof Oo;)t.push(n),n=n.parentNode;e.eventPhase=oo.CAPTURING_PHASE;for(let n=t.length-1;n>=0&&!e.cancelBubble;n--)0===n&&(e.eventPhase=oo.AT_TARGET),t[n].dispatchEvent(e);e.eventPhase=oo.BUBBLING_PHASE;for(let n=1;n<t.length&&!e.cancelBubble;n++)t[n].dispatchEvent(e)}else{const t=this.event[e.type];if(t){e.currentTarget=this;for(let n=0;n<t.length;n++){let r=t[n];if(e.isStopImmediatePropagation)break;(r.options.capture&&e.eventPhase===oo.CAPTURING_PHASE||!r.options.capture&&e.eventPhase===oo.BUBBLING_PHASE||e.eventPhase===oo.AT_TARGET)&&(r.listener(e,r.options),r.options.once&&(t.splice(n,1),n--))}}}return!e.defaultPrevented}hasAttribute(e){return!!this.attr[e]}getAttribute(e){return"style"===e?this.style.cssText:"class"===e?this.className:B(this.attr[e])?void 0:this.attr[e].toString()}setAttribute(e,t){let n=this.attr[e];if(this.attr[e]=t instanceof Object?JSON.stringify(t):String(t),this.hasViewMapping){const n=t;"id"===e?this.domModule.setId(this.nodeId,n):"style"===e?this.style.cssText=n:"class"===e?this.className=n:0!==e.indexOf("data-")&&0!==e.indexOf("snapshot-")&&this.domModule.setAttr(this.nodeId,e,n)}this.ownerDocument.mutationObserverManager.notifyAttribute(this,{oldValue:n,attributeName:e})}removeAttribute(e){0!==e.indexOf("data-")?(this.attr[e]="","id"===e?this.domModule.setId(this.nodeId,""):"class"===e?this.className="":"style"===e?this.style.cssText="":this.domModule.setAttr(this.nodeId,e,"")):delete this.attr[e]}setStyle(e,t){this.style[e]=t}_setInnerHTML(e,t){const n=function(e){Mo.lastIndex=0;let t=Mo.exec(e),n=Mo.exec(e),r=new xo("#root");for(;t;){const s=jo(t);if(s.type===wo.open){let e=new xo(s.value,s);r.addChild(e),r=e}else if(s.type===wo.end)r.parent&&(r=r.parent);else if(s.type===wo.self){let e=new xo(s.value,s);r.addChild(e)}else if(s.type===wo.comment){let e=new Eo(s.value);r.addChild(e)}else{let e=new _o(s.value);r.addChild(e)}t=n,n=Mo.exec(e)}return r.child}(e);this.removeAllChild(!0),this.getChildFromParser(n,t)}_getInnerHTML(e=!1,t=!1){let n="";return this.childNodes.forEach((r=>{if(Oo.is(r)){if(t&&r.attr.hasOwnProperty("snapshot-skip")&&!1!==(s=r.attr["snapshot-skip"])&&"false"!==s)return;const i=r.selfHtml(e);n=n+=`${i.start}${r._getInnerHTML(e,t)}${i.end}`}else n=r.nodeType===co.comment?n+=`\x3c!--${r.textContent}--\x3e`:n+=`${r.textContent}`;var s})),n}selfHtml(e=!1){let t="";this.className&&(t+=` class="${this.className}"`),e&&this.scopedClass.length&&(t+=` __scope__="${this.scopedClass.join(" ")}"`);const n=this.getAttrString();n&&(t+=`${n}`);let r=`<${this.tagName}${t}>`,s=`</${this.tagName}>`;return!this.childNodes.length&&this.isSelfClose&&(r=`<${this.tagName}${t}/>`,s=""),{start:r,end:s}}setAttrObject(e,t=!1){let n={};if(t)for(let t in e)t.indexOf("snapshot-override:")>-1&&(e[t.slice(18)]=e[t]);for(let t in e)"__scope__"===t?(this.addScopedClass(e[t]),delete e[t]):this.setAttribute(t,e[t]);if(t)for(let e in n)this.setAttribute(e,n[e])}getChildFromParser(e,t=!1){for(let n of e)if(xo.is(n)){const e=this.ownerDocument.createElement(n.tagName,{isSnapshot:t,attr:n.attrs});n.child.length&&e.getChildFromParser(n.child,t),e.isSelfClose=n.isSelfClose,this.appendChild(e)}else n instanceof Eo?this.appendChild(this.ownerDocument.createComment(n.value)):this.appendChild(this.ownerDocument.createTextNode(n.value))}updateClass(e,t){const n=[];t&&n.push(t),e&&n.push(...e),this.domModule.setClass(this.nodeId,n.join(" "))}getDebugAttrString(){let e="";for(const t in this.attr)"id"!==t&&"class"!==t&&(e+=`${t}="${this.getAttribute(t)}"`);return e}getAttrString(){let e="";for(const t in this.attr)"class"!==t&&(""===this.attr[t]?e+=` ${t}`:e+=` ${t}="${Co.encode(this.attr[t])}"`);return e}getDebugEventString(){var e;let t="";for(const n in this.event)t+=`@${n}="${null===(e=this.event[n])||void 0===e?void 0:e.length}(listener)"`;return t}pushEventListener(e,t,n){let r=this.event[e],s=!r||0===r.length;if(r){const e=r.findIndex((e=>e.listener===t));e>=0&&r.splice(e,1)}else this.event[e]=r=[];return r.push({options:n,listener:t}),s}}class Po extends Oo{}class No{constructor(){this.elementMap={},this.infos={}}getCustomerClass(e){return this.elementMap[e]}buildComponent(e){for(const t in this.infos)this.infos.hasOwnProperty(t)&&e(t,this.infos[t])}initCustomerElement(e){const t=this;this.infos=e;for(const n in e)if(e.hasOwnProperty(n)){const r=e[n];r.properties=r.properties||[];let s=r.properties.map((e=>e.name)),i=s.map((e=>le(e)));const o=class extends Po{constructor(e){return super(n,e),this.propsCache={},t.wrapCustomerElement(this,this.propsCache,s)}setAttribute(e,t){let n=i.indexOf(e);if(n>-1){this[s[n]]=t,this.attr[e]=t}else super.setAttribute(e,t)}updateProps(e){for(let t in e)this.propsCache[t]=e[t]}};for(const e of r.methods)o.prototype[e.name]=function(...t){return this.domModule.callMethod(this.nodeId,e.name,e,t)};this.elementMap[n]=o}}wrapCustomerElement(e,t,n){return new Proxy(e,{get:(e,r)=>n.indexOf(r)>-1?t[r]:Reflect.get(e,r),set:(e,r,s)=>n.indexOf(r)>-1?(t[r]!==s&&(t[r]=s,e.domModule.setAttr(e.nodeId,r,s)),!0):Reflect.set(e,r,s)})}}const To=[Io.style];class Do extends Oo{constructor(e){super(Io.head,ie(e,{hasViewMapping:!1})),this.stylesheetMap={}}appendChild(e){this.checkAllowedInside(e)&&(super.appendChild(e),this.refreshStyleSheet(e))}insertBefore(e,t){this.checkAllowedInside(e)&&(super.insertBefore(e,t),this.refreshStyleSheet(e))}removeChild(e){this.checkAllowedInside(e)&&(super.removeChild(e),this.refreshStyleSheet(e,!0))}refreshStyleSheet(e,t=!1){let n=B(this.stylesheetMap[e.nodeId])?-1:this.stylesheetMap[e.nodeId];if(n>-1)t?(this.ownerDocument.replaceStyleSheet(n,""),delete this.stylesheetMap[e.nodeId]):this.ownerDocument.replaceStyleSheet(n,e.textContent);else{if(t)return;n=this.ownerDocument.addStyleSheet(e.textContent),this.stylesheetMap[e.nodeId]=n}}checkAllowedInside(e){return e.nodeType===co.element&&To.indexOf(e.tagName)>-1}}class Lo extends Oo{get clientHeight(){return this.domModule.getWindowHeight()}get clientWidth(){return this.domModule.getWindowWidth()}get offsetHeight(){return this.domModule.getWindowHeight()}get offsetWidth(){return this.domModule.getWindowWidth()}get offsetTop(){return 0}get offsetLeft(){return 0}}class ko extends Oo{constructor(e){super(Io.style,ie(e,{hasViewMapping:!1}))}appendChild(e){super.appendChild(e),this.handlerStyleSheet()}insertBefore(e,t){super.insertBefore(e,t),this.handlerStyleSheet()}removeChild(e){super.removeChild(e),this.handlerStyleSheet()}insertAfter(e,t){super.insertAfter(e,t),this.handlerStyleSheet()}handlerStyleSheet(){let e=this.parentNode;e&&e instanceof Do&&e.refreshStyleSheet(this)}}class Ro extends po{get textContent(){return this.data}set textContent(e){this.data=e}get data(){return super.data}set data(e){super.data=e,this.setText()}constructor(e,t){super(co.text,t),this.data=e}decisionViewMapping(e){e instanceof ko?this.hasViewMapping=!1:(this.hasViewMapping=!0,this.domModule.createElement(this.nodeId,"string"),this.setText())}appendData(e){super.appendData(e),this.setText()}deleteData(e,t){super.deleteData(e,t),this.setText()}replaceData(e,t,n=""){super.replaceData(e,t,n),this.setText()}insertData(e,t){super.insertData(e,t),this.setText()}toDebugXML(){return this.data}setText(){this.hasViewMapping&&this.domModule.setText(this.nodeId,this.data)}}function $o(e){return class{constructor(t,n){this.domModule=e.domModule;const r=B(n)?{}:n;this.root=r.root?r.root:e.documentElement,this.rootMargin=r.rootMargin||"0px",r.threshold?this.thresholds=U(r.threshold)?r.threshold:[r.threshold]:this.thresholds=[0],this.createObserverCallback=n=>{const r=n.entries.map((t=>({time:t.time,target:e.getRef(t.target.toString()),rootBounds:Ao.fromRect(t.rootBounds),isIntersecting:t.isIntersecting,intersectionRatio:t.intersectionRatio,boundingClientRect:Ao.fromRect(t.boundingClientRect),intersectionRect:Ao.fromRect(t.intersectionRect)})));t(r,this)},this.id=this.domModule.createIntersectionObserver(this.root.nodeId,JSON.stringify({rootMargin:this.rootMargin,threshold:this.thresholds}),this.createObserverCallback)}disconnect(){this.domModule.deleteIntersectionObserver(this.id),this.createObserverCallback&&this.createObserverCallback.__dispose&&this.createObserverCallback.__dispose(),delete this.createObserverCallback}observe(e){this.domModule.addIntersectionObserver(this.id,JSON.stringify([e.nodeId]))}unobserve(e){this.domModule.removeIntersectionObserver(this.id,JSON.stringify([e.nodeId]))}}}function qo(e,t,n){return{type:e,target:t,addedNodes:n.addedNodes||[],removedNodes:n.removedNodes||[],previousSibling:n.previousSibling||null,nextSibling:n.nextSibling||null,attributeName:n.attributeName||null,attributeNamespace:n.attributeNamespace||null,oldValue:n.oldValue||null}}class Bo{constructor(){this.observerRecords=new Map,this.mutationRecordNotifyMap=new WeakMap}observeNode(e,t,n){let r,s=this.observerRecords.get(e);s?r=s.observerMap:(r=new Map,s={observerMap:r,hasSubtreeCount:0});const i=r.get(t);i&&i.options.subtree&&s.hasSubtreeCount--,n.options.subtree&&(this.observeSubtree(e.childNodes,e,e.mutationObserveParentNode),s.hasSubtreeCount++),r.set(t,n),this.observerRecords.set(e,s)}unObserveNode(e,t){let n,r=this.observerRecords.get(e);if(r){n=r.observerMap;let s=n.get(t);n.delete(t),s&&s.options.subtree&&(r.hasSubtreeCount--,r.hasSubtreeCount<=0&&this.unObserveSubtree(e.childNodes,e,e.mutationObserveParentNode)),0===n.size&&this.observerRecords.delete(e)}}notifyChildList(e,t){this.notifyNode(e,qo("childList",e,t))}notifyAttribute(e,t){this.notifyNode(e,qo("attributes",e,t))}triggerObserverCallback(e,t,n){this.mutationRecordNotifyMap.get(n)!==t&&(e.callback.call(t,n),this.mutationRecordNotifyMap.set(n,t))}notifyNode(e,t){let n=this.observerRecords.get(e),r=null==n?void 0:n.observerMap;r&&r.forEach(((e,n)=>{"attributes"===t.type&&e.options.attributes&&(U(e.options.attributeFilter)?e.options.attributeFilter.indexOf(t.attributeName)>-1&&this.triggerObserverCallback(e,n,t):this.triggerObserverCallback(e,n,t)),"childList"===t.type&&e.options.childList&&this.triggerObserverCallback(e,n,t)}));let s=e.mutationObserveParentNode;for(;s;)this.notifyNode(s,t),s=s.mutationObserveParentNode}observeSubtree(e,t,n){for(const r of e)r.mutationObserveParentNode&&r.mutationObserveParentNode!==n||(r.mutationObserveParentNode=t,r.nodeType===co.element&&this.observeSubtree(r.childNodes,t,n))}unObserveSubtree(e,t,n){for(const r of e)r.mutationObserveParentNode&&r.mutationObserveParentNode===t&&(r.mutationObserveParentNode=n,this.unObserveSubtree(r.childNodes,t,n))}}class Vo{constructor(e){this.callback=e,this.nodeList=new Set,this.records=[],this.timer=-1}disconnect(){this.records=[],this.timer>=0&&e().clearTimeout(this.timer),this.nodeList.forEach((e=>{e.ownerDocument.mutationObserverManager.unObserveNode(e,this)}))}observe(e,t={}){const n=this.getDefaultOptions(t);this.nodeList.add(e),this.instance||(this.instance=e.ownerDocument.instance),e.ownerDocument.mutationObserverManager.observeNode(e,this,{options:n,callback:this.notifyRecord})}takeRecords(){let t=this.records;return this.records=[],this.timer&&e().clearTimeout(this.timer),t}flush(){this.timer=-1;const e=this.records;this.records=[],this.callback(e,this)}notifyRecord(e){this.records.push(e),this.timer<0&&(this.timer=this.instance.injectContext.setTimeout((()=>{this.flush()}),1))}getDefaultOptions(e){let t=U(e.attributeFilter)||e.attributeOldValue;if(t&&!1===e.attributes)throw new TypeError("The options object may only set 'attributeFilter' or 'attributeOldValue' when 'attributes' is true or not present");return ie(e,{subtree:!1,childList:!1,attributes:t,attributeOldValue:!1,characterData:!1,characterDataOldValue:!1})}}class Ho{constructor(e){this.mutationObserverManager=new Bo,this.nodeMap={},this.styleSheets=[],this.customerElementManager=new No,this.id=e.localId.toString(),this.instance=e,this.apiCenter=e.apiCenter,this.domModule=e.requireModule("dom"),this.documentElement=this.createDocumentElement(),this.body=this.createBody(),this.head=this.createHeadElement(),this.documentElement.appendChild(this.head),this.documentElement.appendChild(this.body)}querySelector(e){this.domModule.batch();const t=this.domModule.querySelector(this.documentElement.nodeId,e);return t>=0?this.getRef(t):null}querySelectorAll(e){this.domModule.batch();return this.domModule.querySelectorAll(this.documentElement.nodeId,e).map((e=>this.getRef(e)))}getRef(e){return this.nodeMap[e]}fireEvent(e,t,n){const r=this.nodeMap[e];r&&("lite.updateProps"===t?r.updateProps(n):r.dispatchEvent(function(e,t,n){const r={bubbles:!0,cancelable:!0};so.indexOf(e)>=0&&(r.bubbles=!1);const s=new io(e,r);return s.target=s.currentTarget=t,s.timeStamp=Date.now(),s.detail=n,s}(t,r,n)))}addStyleSheet(e){return this.styleSheets.push(e),this.domModule.appendStyle(e),this.styleSheets.length-1}replaceStyleSheet(e,t){this.styleSheets.splice(e,1,t),this.domModule.replaceStyle(e,t)}clearStyleSheet(){this.styleSheets=[],this.domModule.clearStyle()}destroy(){this.documentElement.destroy();for(const e in this.nodeMap)this.nodeMap[e].destroy();this.domModule.batch()}layout(e){this.domModule&&this.domModule.requestLayout(e)}initCustomerElement(e){this.customerElementManager.initCustomerElement(e)}createElement(e,t={}){if(e===Io.document||e===Io.body)throw new Error("document 和 body 不允许 createElement");let n;const r=this.customerElementManager.getCustomerClass(e);return t.ownerDocument=this,t.docId=this.id,t.nodeId=this.instance.uniqueId(),n=r?new r(t):"style"===e?new ko(t):new Oo(e,t),this.nodeMap[n.nodeId]=n,n}createComment(e){let t=new fo(e,{ownerDocument:this,docId:this.id,nodeId:this.instance.uniqueId()});return this.nodeMap[t.nodeId]=t,t}createTextNode(e){let t=new Ro(e,{ownerDocument:this,docId:this.id,nodeId:this.instance.uniqueId()});return this.nodeMap[t.nodeId]=t,t}getWebContext(){return{getComputedStyle:this.getComputedStyle.bind(this),IntersectionObserver:$o(this),MutationObserver:Vo}}getComputedStyle(e){return new mo(void 0,this.domModule.getComputedStyle(e.nodeId))}createBody(){const e=new Oo(Io.body,{ownerDocument:this,docId:this.id,nodeId:this.instance.uniqueId()});return this.nodeMap[e.nodeId]=e,e}createDocumentElement(){const e=new Lo(Io.document,{ownerDocument:this,docId:this.id,nodeId:this.instance.uniqueId()});return this.nodeMap[e.nodeId]=e,this.domModule.setRootNode(e.nodeId),e}createHeadElement(){const e=new Do({ownerDocument:this,docId:this.id,nodeId:this.instance.uniqueId()});return this.nodeMap[e.nodeId]=e,e}}class Uo extends class{constructor(e,t=[]){this.methodNames=["requireLib","requireModule","addEventListener","removeEventListener"];const n=this.methodNames.concat(e.moduleManager.moduleNames,t);return this.instance=e,new Proxy(this,{ownKeys:()=>n,getOwnPropertyDescriptor(e,t){if(F(t))return e.methodNames.indexOf(t)>-1?{enumerable:!1,configurable:!0}:{enumerable:!0,configurable:!0}},get(e,t){let n=Reflect.get(e,t);return B(n)&&F(t)&&(n=e.requireModule(t)),n},set:()=>!1})}requireLib(e){return this.instance.dynamicImport.call(this.instance,e)}requireModule(e){return this.instance.requireModule(e)}addEventListener(e,t){this.instance.globalEventManager.addEventListener(e,t)}removeEventListener(e,t){this.instance.globalEventManager.removeEventListener(e,t)}}{constructor(e){super(e,[])}}var Fo;!function(e){e.liteSnapshotReadStart="liteSnapshotReadStart",e.liteSnapshotReadEnd="liteSnapshotReadEnd",e.liteSnapshotApplyStart="liteSnapshotApplyStart",e.liteSnapshotApplyEnd="liteSnapshotApplyEnd"}(Fo||(Fo={}));class Wo{constructor(e){this.snapshotMode=!1,this.needAutoSaveSnapshot=!0,this.instance=e}get pageSnapshotKey(){const e=this.instance.requireModule("router");return`liteapp_snap:${e.currentRoute}?${he.stringify(e.currentQuery)}`}save(){let e=this.instance.requireModule("store"),t=this.getModuleRecords();this.instance.baseLibApi.saveSnapshot(this.pageSnapshotKey,JSON.stringify({moduleRecords:t,store:e.storeShadow,html:this.instance.document.body.snapshotInnerHTML,envInfo:{timestamp:Date.now(),baseLibVersion:this.instance.runtimeConfig.baseLibInfo.version,appVersion:this.instance.instanceConfig.version}})),this.needAutoSaveSnapshot=!1}autoSave(){this.needAutoSaveSnapshot&&this.save()}remove(){this.instance.baseLibApi.removeSnapshot(this.pageSnapshotKey)}cancelAutoSave(){this.needAutoSaveSnapshot=!1}load(){return new Promise(((e,t)=>Sn(this,void 0,void 0,(function*(){const n=this.instance.document,r=this.instance.requireModule("store");let s=this.instance.requireModule("performance"),i=s&&s.mark||(e=>{J.info("[instance] performance.mark not found",e)});J.info("[instance] set routeEnter run task",this.instance.id),this.instance.routeEnterProcessController.run((()=>Sn(this,void 0,void 0,(function*(){J.info("[instance] routeEnter task flush");try{i(Fo.liteSnapshotReadStart);let t=yield this.instance.baseLibApi.loadSnapshot(this.pageSnapshotKey);if(i(Fo.liteSnapshotReadEnd),t){let s=JSON.parse(t),o=s.store,a=s.moduleRecords;i(Fo.liteSnapshotApplyStart),a&&this.replayModuleRecords(a),n.body.snapshotInnerHTML=s.html;const c=n.body.children[0],l=n.body.childNodes;if(l.length>1)for(let e=l.length-1;e>=0;e--)l[e]!==c&&n.body.removeChild(l[e]);c.setAttribute("data-server-rendered","true"),r.init(o),i(Fo.liteSnapshotApplyEnd),this.snapshotMode=!0,e(!0)}else this.snapshotMode=!1,e(!1)}catch(e){this.snapshotMode=!1,this.instance.baseLibApi.removeSnapshot(this.pageSnapshotKey),t(e)}}))))}))))}replayModuleRecords(e){for(let t in e){let n=this.instance.requireModule(t);n.__lite__?n.__lite__.replay(e[t]):J.error("[view] module record with nonexistent module",t)}}getModuleRecords(){let e={};for(let t in this.instance.moduleCache){let n=this.instance.moduleCache[t];if(n.__lite__){e[t]=[];let r=n.__lite__.snapshotCallLastCallMap;for(let n in r)e[t].push(r[n])}}return e}}class Ko{constructor(e){this.snapshot=!1,this.syncCall=!0,this.version="0.0.0";let t=e.instanceInfo;if(t){if(t.runtime)for(let e in t.runtime)if(t.runtime.hasOwnProperty(e)){let n=t.runtime[e];B(n)||(this[e]=n)}if(t.hostOverride)for(let e in t.hostOverride)if(t.hostOverride.hasOwnProperty(e)){let n=t.hostOverride[e];B(n)||(this[e]=n)}t.version&&(this.version=t.version)}}}class zo extends class{constructor(t){const n=e();var r;this.Promise=function(e){let t=!1;class n extends Promise{constructor(e){super(e)}then(e,n){return super.then(e?(...n)=>{if(!t)return e(...n)}:void 0,n?e=>{if(!t)return n(e)}:void 0)}catch(e){return super.catch(e?n=>{if(!t)return e(n)}:void 0)}}let r=["all","race","resolve","reject"],s={construct(t,r){let s=new n(r[0]);return s.id=e.id||0,s},get:(s,i)=>r.indexOf(i)>-1?(...t)=>{let r=n[i](...t);return r.id=e.id||0,r}:"destroy"===i?()=>{t=!0}:n[i]};return new Proxy(n,s)}(t.runtimeProps),this.URL=n.URL,this.debugData=t.debugData,this.fetch=(r=t.runtimeProps,(e,t)=>{const n=fetch(e,t);return n.id=r.id,Promise.resolve(n)})}}{constructor(e){super(e),this.setTimeout=e.wrapTimer("setTimeout"),this.setInterval=e.wrapTimer("setInterval"),this.lite=new Uo(e),this.document=e.document;const t=this.document.getWebContext();this.getComputedStyle=t.getComputedStyle,this.MutationObserver=t.MutationObserver,this.IntersectionObserver=t.IntersectionObserver}get devicePixelRatio(){return this.document.domModule.getDevicePixelRatio()}}class Jo{constructor(e){this.instanceManager=e,this.listen()}setUp(e){this.matcher=new RegExp(`__runner_(\\w+)_${e.uuid}__`)}dispatchError(e,t){t&&this.instanceManager.receive(t.instanceId,e)}reportError(t,n,r){r?e().baseLibApi.reportError(r.instanceId,t,n.message,n.stack):e().baseLibApi.reportError(0,t,n.message,n.stack)}stackParse(e){if(!this.matcher)throw new Error("need setUp");if(!e||!e.stack)return;let t=e.stack.match(this.matcher);if(!t)return;let n=t[1];return{instanceId:parseInt(n,10)}}errorHandle(t,n,r){let s=[{name:q.globalEvent,args:["error",[r,"unhandledRejection",n]]}];if(n&&!B(n.id))try{this.instanceManager.receive(n.id,s)}finally{r?e().baseLibApi.reportError(n.id,t,r.message||r.toString(),r.stack):e().baseLibApi.reportError(n.id,t,"no reason","")}else{let e=this.stackParse(r);this.dispatchError(s,e),this.reportError(t,r,e)}}listen(){e().onunhandledrejection=({promise:e,reason:t})=>{this.errorHandle("promise",e,t)},e().wxajs.setPromiseRejectCallback(((t,n,r)=>{try{this.errorHandle(t||"promise",n,r)}catch(t){e().baseLibApi.reportError(0,"system",t.message,t.stack)}}))}}class Go extends Jo{bypassReceive(e,t){for(let n of t)if(n.name===q.globalEvent&&n.args&&"show"===n.args[0])return void(this.stackTopInstanceId=e)}dispatchError(e,t){t?super.dispatchError(e,t):this.stackTopInstanceId&&this.instanceManager.receive(this.stackTopInstanceId,e)}}const Xo={createInstanceContext:()=>({}),destroyInstance(){},refreshInstance(){}},Qo=ne.getInstance();!function(t,n){const r=e();n.NotFramework=Xo,Object.assign(r,{runInInstance:(e,n)=>t.runCodeInInstance({id:e,resource:n}),createInstance:(e,r,s)=>t.createInstance({id:e,resource:r,config:s,framework:n[s.frameworkType]}),destroyInstance:e=>{t.destroyInstance(e)},callJS:(e,n)=>t.receive(e,n),register(e){Qo.register(e)},loadFramework:t=>e().System.import(t),setUp(e){t.setUp(e);for(const e in n)e!==$.NotFramework&&t.preparePreCreateInstance({framework:n[e],config:{frameworkType:e}})}})}(new class extends class{constructor(e){this.runtimeConfig={baseLibInfo:{version:"1.5.2",buildTarget:"undefined",buildType:"production"}},this.preCreateInstanceNum=0,this.instanceMap={},this.preCreateInstanceCache={},this.currentLocalInstanceId=1e4,this.InstanceType=e.InstanceType,this.contextTransform=e.contextTransform,e.AsyncErrorDetector?this.asyncErrorDetector=new e.AsyncErrorDetector(this):this.asyncErrorDetector=new Jo(this)}get uniqLocalId(){return this.currentLocalInstanceId++}setUp(e){if(!e.runnerConfig)throw new Error("初始化缺少参数： runnerConfig");this.asyncErrorDetector.setUp(e.runnerConfig),this.runtimeConfig.hostInfo=e.hostInfo,this.runtimeConfig.runnerConfig=e.runnerConfig}receive(e,t){let n=this.findRuntimeInstance(e);if(n)return n.instance.receiver.receive(t)}findRuntimeInstance(e){return this.instanceMap[e]}destroyInstance(e){const t=this.instanceMap[e];t&&(t.framework.destroyInstance(e),t.instance.destroy(),dn.reportRuntimeInfo(t.instance.reportInfo),delete this.instanceMap[e])}createInstance(e){if(this.instanceMap[e.id])throw new Error(`The instance id "${e.id}" has already been used!`);let t=this.getPreCreateInstance(e);return t.instance.startUp(e.id,{name:e.resource.name,config:e.config}),this.instanceMap[e.id]=t,this.runInContext(e.resource,t),t.instance.afterRunCode(),setTimeout((()=>{this.preparePreCreateInstance(e)}),50),t}runCodeInInstance(e){const t=this.findRuntimeInstance(e.id);if(B(t))throw new Error("请先创建实例");this.runInContext(e.resource,t)}preparePreCreateInstance(e){let t=this.preCreateInstanceCache[e.config.frameworkType];for(t||(t=this.preCreateInstanceCache[e.config.frameworkType]=[]);t.length<this.preCreateInstanceNum;)t.push(this.preCreateInstance(e))}runCodeInContext(e,t){e.call(t.context,t.context)}getPreCreateInstance(e){let t=this.preCreateInstanceCache[e.config.frameworkType];return t&&t.length>0?t.pop():this.preCreateInstance(e)}preCreateInstance(e){let t=new this.InstanceType({localId:this.uniqLocalId,config:e.config,runtimeConfig:this.runtimeConfig,execLib:e=>{this.runLibInContext(e,r)}});const n=this.createInstanceContext(e.framework,t),r={instance:t,framework:e.framework,context:n};return r}runLibInContext(e,t){let n={exports:{}};return e.code.call(t.context,n,t.context),t.instance.libsMap[e.name]=n.exports}runInContext(e,t){if(e.libs)for(const n of e.libs)this.runLibInContext(n,t);Object.seal(t.instance),Object.seal(t),e.code&&this.runCodeInContext(e.code,t)}createInstanceContext(e,t){let n=t.getContext(),r=n;return this.contextTransform&&(r=this.contextTransform(t,r)),Object.assign(r,e.createInstanceContext(t.localId,n,t),{globalThis:r,global:r,self:r}),r}}{constructor(e){e.AsyncErrorDetector||(e.AsyncErrorDetector=Go),super(e)}receive(e,t){super.receive(e,t),this.asyncErrorDetector.bypassReceive(e,t)}runCodeInContext(e,t){t.instance.instanceConfig.snapshot?t.instance.loadSnapShot().then((e=>{})).catch((()=>{})).finally((()=>{super.runCodeInContext(e,t),t.instance.globalEventManager.flushDeferEvent()})):super.runCodeInContext(e,t)}}({InstanceType:class extends class extends class{constructor(e){this.reportInfo={},this.id=-9999,this.runtimeProps={},this.runtimeContext={},this.callbackManager=new se,this.syncCallManager=new cn,this.isReady=!1,this.libsMap={},this.debugData={},this.name="unnamed",this.moduleCache={},this.currentUniqueId=1,this.timerDisposers={setTimeout:[],setInterval:[]},"localId"in e?this.localId=e.localId:(this.id=e.id,this.localId=e.id,this.isReady=!0),this.execLib=e.execLib,this.baseLibModule=new ve(this),this.config=e.config,this.runtimeConfig=e.runtimeConfig}setRuntimeContext(e){this.runtimeContext=e}wrapTimer(t,n){let r=this.timerDisposers[t];return(s,i,...o)=>{let a=e()[t].call(null,(()=>{try{s(),n&&n()}catch(t){this.receiver.receive([{name:q.globalEvent,args:["error",[t,"uncaughtException"]]}]),e().baseLibApi.reportError(this.id,"timer",t.message,t.stack)}r.splice(r.indexOf(a),1)}),i,...o);return r.push(a),a}}startUp(e,{name:t}){this.id=e,this.runtimeProps.id=e,this.isReady=!0,t&&(this.name=t),this.apiCenter.startUp()}uniqueId(){return this.currentUniqueId++}destroy(){this.reportInfo.callbackNumAtDestroy=this.callbackManager.callbacks.length,this.reportInfo.moduleRequireNumber=this.moduleManager.requireNumber,this.timerDisposers.setTimeout.forEach((t=>{e().clearTimeout(t)})),this.timerDisposers.setInterval.forEach((t=>{e().clearInterval(t)})),this.receiver.destroy(),this.apiCenter.destroy(),this.injectContext.Promise.destroy()}debugMode(){}afterRunCode(){this.reportInfo.callbackNumAtFirstRun=this.callbackManager.callbacks.length}requirePrivateModule(e){let t=this.moduleCache[e];return B(t)&&(t=this.moduleManager.requirePrivateModule(this,e),t&&(this.moduleCache[e]=t)),t}requireModule(e){let t=this.moduleCache[e];return B(t)&&(t=Object.seal(this.moduleManager.requireModule(this,e)),t&&(this.moduleCache[e]=t)),t}dynamicImport(e){return new Promise(((t,n)=>{B(this.libsMap[e])?this.baseLibModule.loadLib(e,((r,s)=>{r||!s?n(r):t(this.libsMap[e])})):t(this.libsMap[e])}))}}{}{constructor(e){super(e),this.register=ne.getInstance(),this.componentsRegisterInfo=this.register.componentsInfo,this.reportInfo.type="flutter-view",this.apiCenter=new re({callbackManager:this.callbackManager,instance:this}),this.receiver=new G(this,[ln,hn,un],{afterReceiveHook:()=>{this.document.layout()}}),this.instanceConfig=new Ko(this.config),this.moduleManager=no.getInstance(),this.document=new Ho(this),this.globalEventManager=new me(this,{defer:this.instanceConfig.snapshot}),this.routeEnterProcessController=new Ui(this),this.baseLibApi=this.requirePrivateModule("baseLibApi"),this.snapshotManager=new Wo(this),this.injectContext=new zo(this)}loadSnapShot(){return this.snapshotManager.load()}startUp(e,t){super.startUp(e,t),J.info("start up"),this.instanceConfig=new Ko(t.config),this.document.initCustomerElement(this.register.componentsInfo),pn.start(`FlutterPage startUp${this.id}`)}afterRunCode(){super.afterRunCode(),this.reportInfo.nodeNumAtFirstRun=Object.keys(this.document.nodeMap).length}wrapTimer(e){return super.wrapTimer(e,(()=>{this.document.layout()}))}getContext(){return this.injectContext}destroy(){this.instanceConfig.snapshot&&this.snapshotManager.autoSave(),this.reportInfo.nodeNumAtDestroy=Object.keys(this.document.nodeMap).length,this.document.destroy(),this.requireModule("store").destroy(),super.destroy()}}}),e().frameworks)}}}));
