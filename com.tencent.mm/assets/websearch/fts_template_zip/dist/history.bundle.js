(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{1055:function(t,e,n){},1056:function(t,e,n){},1608:function(t,e,n){"use strict";var i=n(1055);n.n(i).a},1609:function(t,e,n){"use strict";var i=n(1056);n.n(i).a},1707:function(t,e,n){"use strict";n.r(e);var i=n(98),o=n.n(i),s=n(1),r=n.n(s),a=n(36),c=n.n(a),l=n(66),h=n.n(l),u=n(74),p=n(26),d=n(0),f={props:{item:{type:Object,default:function(){return{}}},pos:{type:Number,default:0}},methods:{tapDelete:function(){this.$emit("tap:delete",this.item,this.pos)},tapItem:function(){this.$emit("tap:item",this.item,this.pos)}}},m=(n(1608),n(25)),y=Object(m.a)(f,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"line history__line",attrs:{"data-expose-id":t.pos+"$$"+t.item.id+"$$"+t.item.hotword},on:{click:t.tapItem}},[n("div",{staticClass:"line__item"},[n("div",{staticClass:"history__icon",attrs:{"aria-hidden":"true"}},[n("svg-icon",{staticClass:"history__icon-clock",attrs:{name:"clock"}})],1)]),t._v(" "),n("div",{staticClass:"line__item primary history__info line",attrs:{role:"button"}},[n("p",{staticClass:"history__title"},[t._v("\n      "+t._s(t.item.hotword)+"\n    ")]),t._v(" "),t.item.jumpUrl?n("p",{staticClass:"history__sub"},[t._v("\n      "+t._s(t.item.jumpUrl)+"\n    ")]):t._e()]),t._v(" "),n("div",{staticClass:"line__item"},[n("div",{staticClass:"history__delete",attrs:{role:"button","aria-label":"删除"},on:{touchstart:function(t){t.stopPropagation()},click:function(e){return e.stopPropagation(),e.preventDefault(),t.tapDelete(e)}}},[n("svg-icon",{staticClass:"history__delete-icon",attrs:{name:"cross"}})],1)])])}),[],!1,null,null,null).exports,_=n(49),v=n(2),b=n(5),g=n(37);function w(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function I(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?w(Object(n),!0).forEach((function(e){r()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var E={components:{"history-item":y,scroll:n(539).a},mixins:[d.i],data:function(){return{historyList:[],showDelete:!1,reportEmpty:!1,pageId:"history".concat(Date.now())}},computed:{localStorageKey:function(){return d.b.scene===v.e.scene.VERTICAL||d.b.scene===v.e.scene.HOME_TOP_MORE_ENTRY||d.b.scene===v.e.scene.HOME_TOP_ENTRY||d.b.scene===v.e.scene.WXAPP?"history".concat(d.b.type):"history0"}},created:function(){var t=this,e=this;if(_.b.onHisReady((function(e){if(_.a.delHis({isDeleteAll:1}),e.data&&e.data.length&&e.data[0].items.length){var n=e.data[0].items.map((function(t){return{hotword:t.word,id:d.f.generateGuuId().substring(0,13)}}));t.historyList=n,d.d.set({key:t.localStorageKey,value:n})}})),e.getData(),b.a.$on(b.b.GO_TO_HISTORY,(function(){t.KEYBOARD_HISTORY_REQUESTID="",t.pageId="history".concat(Date.now()),e.getData()})),d.b.scene===v.c.KEYBOARD_HISTORY){var n="";try{n=d.b.parentSearchID?d.b.parentSearchID.split(":").pop():""}catch(t){}this.KEYBOARD_HISTORY_REQUESTID=n}},methods:{report:function(t){t=["","",d.b.platform,"","",parseInt(+new Date/1e3),"",""].concat(t),_.a.commonCgi({cgiName:g.a.mmDataReport,data:{clientversion:Number(d.b.clientVersion),device:d.b.os.ios?1:d.b.os.android?2:-1,item_list:[{logid:14884,log_buffer:t.join(",")}]}})},getData:function(){var t=this;return h()(c.a.mark((function e(){var n,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.d.get({key:t.localStorageKey});case 2:if(n=e.sent,t.historyList=n||[],t.showDelete=t.historyList.length,t.historyList.length){e.next=14;break}if(d.b.isSupportPermanentData||_.a.getHis({scene:d.b.scene}),!t.reportEmpty){e.next=9;break}return e.abrupt("return");case 9:t.reportEmpty=!0,i=[4,"",d.b.scene,0,"",t.historyList.length,"","",d.b.sessionId,t.KEYBOARD_HISTORY_REQUESTID,t.pageId],t.report(i),e.next=15;break;case 14:_.a.delHis({isDeleteAll:1});case 15:case"end":return e.stop()}}),e)})))()},tapDeleteAll:function(){this.historyList=[],this.showDelete=!1,d.d.remove({key:this.localStorageKey}),_.a.delHis({isDeleteAll:1});var t=[2,"",d.b.scene,0,"",this.historyList.length,"","",d.b.sessionId,this.KEYBOARD_HISTORY_REQUESTID,this.pageId];this.report(t)},tapDelete:function(t,e){var n=this;return h()(c.a.mark((function i(){var o,s,r,a;return c.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return o=n.historyList.splice(e,1)[0],n.historyList.length||(n.showDelete=!1),s=n.localStorageKey,i.next=5,d.d.get({key:s});case 5:(r=i.sent)&&r.length&&(r.forEach((function(t,e){t.id==o.id&&r.splice(e,1)})),d.d.set({key:s,value:r})),_.a.delHis({isDeleteAll:0,query:t.word}),a=["1",encodeURIComponent(o.hotword),d.b.scene,(t.showType||0)+1,o.id,n.historyList.length,encodeURIComponent(o.hotword),e,d.b.sessionId,n.KEYBOARD_HISTORY_REQUESTID,n.pageId],n.report(a),Object(p.c)(u.a.detail.history.hisDel);case 11:case"end":return i.stop()}}),i)})))()},tapItem:function(t,e){_.a.setInputBar({query:t.hotword,isInputChange:!1}),d.b.setValue({query:t.hotword,searchId:""}),t.showType?_.a.openView(I(I({},d.b.getBase()),{},{actionType:8,jumpUrl:t.jumpUrl,query:t.hotword})):b.a.$emit(b.b.GOTO,{page:v.d.RESULT,query:t.hotword,action:v.h.HISTORY,searchId:"",extReqParams:{key:"parentSearchID",textValue:this.M_composeParentSid({t:v.i.SEARCH_HISTORY,s:"",did:t.hotword,rid:this.KEYBOARD_HISTORY_REQUESTID})}});var n=["3",encodeURIComponent(t.hotword),d.b.scene,(t.showType||0)+1,t.id,this.historyList.length,encodeURIComponent(t.hotword),e,d.b.sessionId,this.KEYBOARD_HISTORY_REQUESTID,this.pageId];this.report(n),Object(p.c)(u.a.detail.history.his)},expose:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(t.length){var e=[],n=[],i=[];t.forEach((function(t){var s=t.split("$$"),r=o()(s,3),a=r[0],c=r[1],l=r[2];i.push(a),e.push(c),n.push(encodeURIComponent(l))}));var s=[4,"",d.b.scene,0,e.join("|"),this.historyList.length,n.join("|"),i.join("|"),d.b.sessionId,this.KEYBOARD_HISTORY_REQUESTID,this.pageId];this.report(s)}}}},O=(n(1609),Object(m.a)(E,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("scroll",{attrs:{expose:t.expose}},[n("div",{staticClass:"history-page"},[n("div",[n("div",{staticClass:"ui-aria-hidden"},[t._v("历史记录")]),t._v(" "),t._l(t.historyList,(function(e,i){return n("history-item",{key:i,attrs:{item:e,pos:i},on:{"tap:delete":t.tapDelete,"tap:item":t.tapItem}})}))],2),t._v(" "),t.showDelete?n("div",{staticClass:"history__clear-all",attrs:{role:"button"},on:{click:t.tapDeleteAll}},[n("svg-icon",{staticClass:"history__clear-icon",attrs:{name:"trashcan"}}),t._v(" "),n("span",{staticClass:"history__clear-text"},[t._v("清除历史")])],1):t._e()])])}),[],!1,null,null,null));e.default=O.exports},531:function(t,e,n){"use strict";n.r(e),n.d(e,"Expose",(function(){return r}));var i=n(5),o=!1;try{var s={get passive(){return o={passive:!0},!0}};window.addEventListener("test",s,s),window.removeEventListener("test",s,s)}catch(t){o=!1}function r(t,e){var n=this;if("function"!=typeof t)throw"Expose must give a handler function.";(e=Object.assign({isBindScrollAtContainer:!1,container:document.body,exposeRepeatedly:!1,isHorizontal:!1,attr:"data-expose-id",ensureWithinContainer:!1},e)).container=e.container||document.body,this.opt=e,this.timeout=null,this.exposedId=[],this.handler=t,this.onScroll=function(){clearTimeout(n.timeout),n.timeout=setTimeout((function(){n.analysis()}),e.dur||200)},this.resetExposeId=function(){n.exposedId=[]},e.isBindScrollAtContainer?e.container.addEventListener("scroll",this.onScroll,o):window.addEventListener("scroll",this.onScroll,o),i.a.$on(i.b.newSearchArrived,this.resetExposeId)}r.prototype.analysis=function(t){this.bounceW=window.innerWidth,this.bounceH=window.innerHeight,t&&(this.opt.attr=t);for(var e=this.opt.container.querySelectorAll("[".concat(this.opt.attr,"]")),n=[],i={height:{}},o=this.opt.container.getBoundingClientRect(),s=0,r=e.length;s<r;++s){var a=e[s],c=a.getBoundingClientRect(),l=+a.getAttribute("data-expose-ratio")||1;if(c.left+c.right!==0&&c.top+c.bottom!==0){if(this.opt.ensureWithinContainer){var h=Math.max(c.left,o.left),u=Math.max(c.top,o.top),p=Math.min(c.left+c.width,o.left+o.width),d=Math.min(c.top+c.height,o.top+o.height);if(h>=p||u>=d)continue;if(c.width*c.height*l>(p-h)*(d-u))continue}if(Math.floor(c.left+c.width)*l<=this.bounceW&&Math.floor(c.top+c.height)*l<=this.bounceH){var f=a.getAttribute(this.opt.attr);if(!f)continue;this.exposedId.includes(f)||(this.exposedId.push(f),n.push(f)),i.height[f]=c.height}}}this.handler(n,i)},r.prototype.destory=function(){i.a.$off(i.b.newSearchArrived,this.resetExposeId),this.opt.isBindScrollAtContainer?this.opt.container.removeEventListener("scroll",this.onScroll,!1):window.removeEventListener("scroll",this.onScroll,!1)}},539:function(t,e,n){"use strict";var i=n(531),o=n(13),s={props:{end:{type:Function,default:function(){}},scroll:{type:Function,default:function(){}},expose:{type:Function,default:function(){}},analysis:{type:Function,default:function(){}},exposeOption:{type:Object,default:function(){return{}}},on:{type:Boolean,default:!0},attr:{type:String,default:void 0}},data:function(){return{exposeInstance:null,analysisTimer:null,scrollTimer:null}},mounted:function(){var t=this;window.addEventListener("scroll",t.onscroll,!1),setTimeout((function(){t.exposeInstance=new i.Expose((function(e,n){t.expose(e,n)}),Object.assign({container:t.$el},t.exposeOption)),t._analysis(t.attr)}))},destroyed:function(){this._destroy()},updated:function(){var t=this;setTimeout((function(){t._analysis(t.attr)}))},methods:{_destroy:function(){this.exposeInstance&&this.exposeInstance.destory(),window.removeEventListener("scroll",this.onscroll)},_scrollFn:function(){this.scroll(),this._isScrollToEnd()&&this.end()},_throttle:o.a.throttle((function(){this._scrollFn()})),_isScrollToEnd:function(){var t=window.innerHeight||document.documentElement.clientHeight,e=window.pageYOffset||document.documentElement.scrollTop;return this.$root.$el.scrollHeight-e-t<=5},_analysis:function(){var t=this;t.analysisTimer&&clearTimeout(t.analysisTimer),t.analysisTimer=setTimeout((function(){t.analysis(),t.exposeInstance.analysis(t.attr)}),300)},onscroll:function(){var t=this;t.on&&(t._throttle(),t.scrollTimer&&clearTimeout(t.scrollTimer),t.scrollTimer=setTimeout((function(){t._scrollFn()}),200))}}},r=n(25),a=Object(r.a)(s,(function(){var t=this.$createElement;return(this._self._c||t)("div",[this._t("default")],2)}),[],!1,null,null,null);e.a=a.exports}}]);